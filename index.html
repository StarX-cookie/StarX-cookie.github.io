<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°‘å¹´ç‰¹å·¥ - å¯†ç å·¥å…·é›† & å¤œèºè¡ŒåŠ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
            background-color: #1a1f0d;
            color: #d4c9a9;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(58, 68, 18, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(88, 98, 38, 0.2) 0%, transparent 50%);
            position: relative;
        }
        
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect fill="%23d4c9a9" width="100" height="100"/></svg>');
            background-size: 20px 20px;
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 60px;
            width: 100%;
        }
        
        h1 {
            font-size: 5rem;
            color: #e8dfb9;
            text-transform: uppercase;
            letter-spacing: 8px;
            text-shadow: 
                0 0 10px rgba(232, 223, 185, 0.5),
                2px 2px 4px rgba(0, 0, 0, 0.8),
                4px 4px 0 #8a7c3d;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
            padding: 0 30px;
        }
        
        h1::before, h1::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 40px;
            height: 4px;
            background: linear-gradient(to right, transparent, #d4c9a9, transparent);
        }
        
        h1::before {
            left: 0;
        }
        
        h1::after {
            right: 0;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #9e9466;
            font-style: italic;
            letter-spacing: 2px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.8;
        }
        
        .buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            width: 100%;
            max-width: 900px;
        }
        
        .btn {
            flex: 1;
            min-width: 250px;
            max-width: 280px;
            padding: 25px 20px;
            background: linear-gradient(145deg, #2a2f15, #1a1f0d);
            border: 2px solid #5a5a2a;
            color: #d4c9a9;
            font-family: inherit;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.4s;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 201, 169, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover {
            transform: translateY(-5px);
            border-color: #d4c9a9;
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(212, 201, 169, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            color: #f0e6c3;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-icon {
            display: block;
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #9e9466;
            transition: color 0.3s;
        }
        
        .btn:hover .btn-icon {
            color: #d4c9a9;
        }
        
        .btn-description {
            font-size: 0.9rem;
            color: #9e9466;
            margin-top: 10px;
            font-weight: normal;
            text-transform: none;
            letter-spacing: 1px;
            line-height: 1.5;
            transition: color 0.3s;
        }
        
        .btn:hover .btn-description {
            color: #d4c9a9;
        }
        
        .tool-container {
            display: none;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            background-color: #2a2f15;
            border: 2px solid #5a5a2a;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .tool-container.active {
            display: block;
        }
        
        .tool-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #5a5a2a;
        }
        
        .tool-title {
            font-size: 2.5rem;
            color: #e8dfb9;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 10px;
        }
        
        .tool-subtitle {
            font-size: 1rem;
            color: #9e9466;
            font-style: italic;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 15px;
            background-color: #5a5a2a;
            color: #d4c9a9;
            border: 1px solid #9e9466;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background-color: #6b6b33;
            transform: translateY(-2px);
        }
        
        /* æ‘©æ–¯ç”µç æ ·å¼ */
        .morse-input-section {
            margin-bottom: 30px;
        }
        
        .morse-input-group {
            margin-bottom: 20px;
        }
        
        .morse-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #b8ad80;
        }
        
        .morse-input {
            width: 100%;
            padding: 12px;
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            color: #d4c9a9;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            border-radius: 3px;
            margin-bottom: 15px;
        }
        
        .morse-input:focus {
            outline: none;
            border-color: #d4c9a9;
            box-shadow: 0 0 5px rgba(212, 201, 169, 0.5);
        }
        
        .morse-output {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 15px;
            min-height: 60px;
            font-size: 1.4rem;
            letter-spacing: 3px;
            margin-bottom: 20px;
            border-radius: 3px;
            color: #f0e6c3;
            text-shadow: 0 0 5px rgba(240, 230, 195, 0.3);
        }
        
        .morse-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .morse-btn {
            flex: 1;
            padding: 12px;
            background-color: #5a5a2a;
            color: #d4c9a9;
            border: 1px solid #9e9466;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .morse-btn:hover {
            background-color: #6b6b33;
            box-shadow: 0 0 8px rgba(212, 201, 169, 0.3);
        }
        
        .morse-reference {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #5a5a2a;
        }
        
        .morse-reference h2 {
            font-size: 1.4rem;
            color: #d4c9a9;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .morse-reference-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .morse-reference-item {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 8px;
            border-radius: 3px;
            text-align: center;
        }
        
        .morse-char {
            font-weight: bold;
            color: #f0e6c3;
        }
        
        .morse-code {
            color: #9e9466;
            font-size: 0.9rem;
        }
        
        .morse-flash {
            animation: flash 0.5s;
        }
        
        .morse-sound-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #5a5a2a;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .morse-sound-indicator.active {
            background-color: #d4c9a9;
            box-shadow: 0 0 8px #d4c9a9;
        }
        
        /* å‡¯æ’’å¯†ç æ ·å¼ */
        .caesar-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #5a5a2a;
        }
        
        .caesar-tab {
            padding: 10px 20px;
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            border-bottom: none;
            margin-right: 5px;
            cursor: pointer;
            border-radius: 3px 3px 0 0;
            font-weight: bold;
        }
        
        .caesar-tab.active {
            background-color: #5a5a2a;
            color: #f0e6c3;
        }
        
        .caesar-tab-content {
            display: none;
        }
        
        .caesar-tab-content.active {
            display: block;
        }
        
        .caesar-input-group {
            margin-bottom: 20px;
        }
        
        .caesar-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #b8ad80;
        }
        
        .caesar-textarea {
            width: 100%;
            padding: 12px;
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            color: #d4c9a9;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            border-radius: 3px;
            min-height: 100px;
            resize: vertical;
        }
        
        .caesar-textarea:focus {
            outline: none;
            border-color: #d4c9a9;
            box-shadow: 0 0 5px rgba(212, 201, 169, 0.5);
        }
        
        .caesar-key-input {
            width: 80px;
            text-align: center;
        }
        
        .caesar-output {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 15px;
            min-height: 60px;
            font-size: 1.2rem;
            letter-spacing: 1px;
            margin-bottom: 20px;
            border-radius: 3px;
            color: #f0e6c3;
            text-shadow: 0 0 5px rgba(240, 230, 195, 0.3);
            white-space: pre-wrap;
        }
        
        .caesar-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .caesar-btn {
            flex: 1;
            padding: 12px;
            background-color: #5a5a2a;
            color: #d4c9a9;
            border: 1px solid #9e9466;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .caesar-btn:hover {
            background-color: #6b6b33;
            box-shadow: 0 0 8px rgba(212, 201, 169, 0.3);
        }
        
        .caesar-reference {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #5a5a2a;
        }
        
        .caesar-reference h2 {
            font-size: 1.4rem;
            color: #d4c9a9;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .caesar-reference-content {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 15px;
            border-radius: 3px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .caesar-warning {
            color: #d4a959;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .caesar-flash {
            animation: flash 0.5s;
        }
        
        /* æ©å°¼æ ¼ç›æœºæ ·å¼ */
        .enigma-rotors-section {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .enigma-rotors-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #d4c9a9;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .enigma-rotors-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .enigma-rotor {
            background-color: #222;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            width: 120px;
        }
        
        .enigma-rotor-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }
        
        .enigma-rotor-display {
            background-color: #000;
            border: 1px solid #444;
            padding: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #d4c9a9;
            margin-bottom: 10px;
            border-radius: 3px;
        }
        
        .enigma-rotor-controls {
            display: flex;
            justify-content: space-between;
        }
        
        .enigma-rotor-btn {
            background-color: #333;
            color: #d4c9a9;
            border: 1px solid #555;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .enigma-rotor-btn:hover {
            background-color: #444;
        }
        
        .enigma-plugboard-section {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .enigma-plugboard-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #d4c9a9;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .enigma-plugboard {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .enigma-plug {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .enigma-plug-letter {
            background-color: #222;
            border: 1px solid #555;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .enigma-plug-cable {
            width: 30px;
            height: 5px;
            background-color: #555;
        }
        
        .enigma-keyboard-lampboard {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .enigma-lampboard, .enigma-keyboard {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 20px;
            border-radius: 5px;
            flex: 1;
        }
        
        .enigma-section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #d4c9a9;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .enigma-lamp-grid, .enigma-key-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 8px;
        }
        
        .enigma-lamp, .enigma-key {
            background-color: #222;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 12px 5px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .enigma-key:hover {
            background-color: #333;
        }
        
        .enigma-lamp.active {
            background-color: #d4a959;
            color: #000;
            box-shadow: 0 0 10px #d4a959;
        }
        
        .enigma-key.pressed {
            background-color: #555;
            transform: translateY(2px);
        }
        
        .enigma-input-output {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .enigma-input-area, .enigma-output-area {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 20px;
            border-radius: 5px;
            flex: 1;
        }
        
        .enigma-textarea {
            width: 100%;
            padding: 12px;
            background-color: #000;
            border: 1px solid #444;
            color: #d4c9a9;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            border-radius: 3px;
            min-height: 100px;
            resize: vertical;
        }
        
        .enigma-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .enigma-btn {
            flex: 1;
            padding: 12px;
            background-color: #333;
            color: #d4c9a9;
            border: 1px solid #555;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .enigma-btn:hover {
            background-color: #444;
        }
        
        .enigma-history {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .enigma-history-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #d4c9a9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .enigma-history-item {
            font-family: 'Courier New', monospace;
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid #222;
        }
        
        .enigma-input-char {
            color: #d4a959;
        }
        
        .enigma-output-char {
            color: #8fbc8f;
        }
        
        .enigma-status {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #888;
        }
        
        /* ç‰¹å·¥ä»»åŠ¡æ ·å¼ */
        .mission-container {
            display: none;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            background-color: #2a2f15;
            border: 2px solid #5a5a2a;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .mission-container.active {
            display: block;
        }
        
        .mission-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #5a5a2a;
        }
        
        .mission-title {
            font-size: 2.5rem;
            color: #e8dfb9;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 10px;
        }
        
        .mission-subtitle {
            font-size: 1rem;
            color: #9e9466;
            font-style: italic;
        }
        
        .mission-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #5a5a2a;
        }
        
        .mission-tab {
            padding: 10px 20px;
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            border-bottom: none;
            margin-right: 5px;
            cursor: pointer;
            border-radius: 3px 3px 0 0;
            font-weight: bold;
        }
        
        .mission-tab.active {
            background-color: #5a5a2a;
            color: #f0e6c3;
        }
        
        .mission-tab-content {
            display: none;
        }
        
        .mission-tab-content.active {
            display: block;
        }
        
        .mission-levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .mission-level {
            background-color: #1a1f0d;
            border: 2px solid #5a5a2a;
            border-radius: 8px;
            padding: 20px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .mission-level:hover {
            border-color: #d4c9a9;
            transform: translateY(-3px);
        }
        
        .mission-level.completed {
            border-color: #8fbc8f;
            background-color: #1a2f15;
        }
        
        .mission-level.completed::after {
            content: "âœ“";
            position: absolute;
            top: 5px;
            right: 5px;
            color: #8fbc8f;
            font-weight: bold;
        }
        
        .mission-level.unlocked {
            border-color: #d4a959;
            background-color: #2f2a15;
        }
        
        .mission-level.locked {
            background-color: #1a1a1a;
            border-color: #333;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .mission-level-number {
            font-size: 2rem;
            color: #d4c9a9;
            margin-bottom: 10px;
        }
        
        .mission-level-title {
            font-size: 0.9rem;
            color: #9e9466;
        }
        
        .mission-details {
            background-color: #1a1f0d;
            border: 1px solid #5a5a2a;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .mission-details-title {
            font-size: 1.5rem;
            color: #e8dfb9;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .mission-details-description {
            color: #d4c9a9;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .mission-input-group {
            margin-bottom: 20px;
        }
        
        .mission-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #b8ad80;
        }
        
        .mission-input {
            width: 100%;
            padding: 12px;
            background-color: #0a0f05;
            border: 1px solid #5a5a2a;
            color: #d4c9a9;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            border-radius: 3px;
        }
        
        .mission-input:focus {
            outline: none;
            border-color: #d4c9a9;
            box-shadow: 0 0 5px rgba(212, 201, 169, 0.5);
        }
        
        .mission-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .mission-btn {
            flex: 1;
            padding: 12px;
            background-color: #5a5a2a;
            color: #d4c9a9;
            border: 1px solid #9e9466;
            font-family: inherit;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .mission-btn:hover {
            background-color: #6b6b33;
            box-shadow: 0 0 8px rgba(212, 201, 169, 0.3);
        }
        
        .mission-btn:disabled {
            background-color: #333;
            color: #666;
            cursor: not-allowed;
            border-color: #444;
        }
        
        .mission-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .mission-result.success {
            background-color: rgba(143, 188, 143, 0.2);
            border: 1px solid #8fbc8f;
            color: #8fbc8f;
            display: block;
        }
        
        .mission-result.failure {
            background-color: rgba(188, 143, 143, 0.2);
            border: 1px solid #bc8f8f;
            color: #bc8f8f;
            display: block;
        }
        
        .certificate-container {
            text-align: center;
            padding: 40px 20px;
            background-color: #1a1f0d;
            border: 2px solid #5a5a2a;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .certificate-container.active {
            display: block;
        }
        
        .certificate-title {
            font-size: 3rem;
            color: #e8dfb9;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 0 0 10px rgba(232, 223, 185, 0.5);
        }
        
        .certificate-subtitle {
            font-size: 1.5rem;
            color: #d4c9a9;
            margin-bottom: 30px;
        }
        
        .certificate-content {
            font-size: 1.2rem;
            color: #9e9466;
            line-height: 1.8;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .certificate-seal {
            width: 150px;
            height: 150px;
            border: 3px solid #d4a959;
            border-radius: 50%;
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #d4a959;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .certificate-download {
            padding: 12px 25px;
            background-color: #5a5a2a;
            color: #d4c9a9;
            border: 1px solid #9e9466;
            font-family: inherit;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }
        
        .certificate-download:hover {
            background-color: #6b6b33;
            box-shadow: 0 0 8px rgba(212, 201, 169, 0.3);
        }
        
        .progress-bar {
            height: 10px;
            background-color: #1a1f0d;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #5a5a2a, #d4a959);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            text-align: center;
            color: #9e9466;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        /* æ¸¸æˆå®¹å™¨æ ·å¼ */
        .game-container {
            display: none;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            background-color: #2a2f15;
            border: 2px solid #5a5a2a;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .game-container.active {
            display: block;
        }
        
        /* æ¸¸æˆç•Œé¢æ ·å¼ */
        .game-terminal {
            width: 100%;
            height: 600px;
            background-color: #1a1a1a;
            border: 2px solid #4a4a4a;
            box-shadow: 0 0 40px rgba(0,0,0,0.9);
            position: relative;
            display: flex;
            flex-direction: column;
            border-radius: 4px;
        }
        
        .game-viewport {
            flex: 6;
            background-color: #111;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid #000;
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease;
        }
        
        .game-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.7));
            pointer-events: none;
            z-index: 1;
        }
        
        .game-character {
            position: absolute;
            bottom: 0;
            height: 400px;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            z-index: 10;
            filter: 
                grayscale(80%) 
                brightness(80%)
                drop-shadow(0 0 3px rgba(0,0,0,0.7));
            mix-blend-mode: darken;
        }
        
        .game-character[src=""] {
            background-color: transparent !important;
        }
        
        .game-char-left { 
            left: 50px; 
            transform: translateX(-50px); 
        }
        .game-char-right { 
            right: 50px; 
            transform: translateX(50px); 
        }
        
        .game-char-active { 
            opacity: 1 !important; 
            transform: translateX(0) !important; 
            mix-blend-mode: normal !important;
        }
        
        .game-speaking { 
            filter: 
                brightness(100%)
                drop-shadow(0 0 8px rgba(255, 204, 0, 0.3)) !important; 
            mix-blend-mode: normal !important;
            z-index: 12; 
        }
        .game-silent { 
            filter: 
                grayscale(90%) 
                brightness(50%)
                drop-shadow(0 0 2px rgba(0,0,0,0.5)) !important; 
            mix-blend-mode: darken !important;
            z-index: 10; 
        }
        
        .game-interface {
            flex: 4;
            background: #111;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }
        
        .game-speaker-box {
            color: #ffcc00;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        
        .game-text-box {
            font-size: 17px;
            line-height: 1.6;
            flex-grow: 1;
            color: #eee;
            text-shadow: 0 0 2px #000;
            padding: 10px 0;
            min-height: 120px;
        }
        
        .game-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #333;
        }
        
        .game-btn {
            background: #222;
            border: 1px solid #ffcc00;
            color: #ffcc00;
            padding: 10px 25px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 1px;
        }
        .game-btn:hover { 
            background: #ffcc00; 
            color: #000; 
            box-shadow: 0 0 8px #ffcc00;
            transform: translateY(-1px);
        }
        .game-btn:active {
            transform: translateY(0);
        }
        
        .game-puzzle-box {
            display: none;
            width: 100%;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            margin-top: 10px;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
        }
        .game-puzzle-input {
            background: #000;
            border: 1px solid #ffcc00;
            color: #0f0;
            padding: 10px;
            font-family: inherit;
            width: 250px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 5px;
            text-shadow: 0 0 5px #0f0;
            box-shadow: 0 0 5px rgba(0,255,0,0.3) inset;
        }
        .game-puzzle-input::placeholder {
            color: #666;
            letter-spacing: normal;
        }
        
        .game-puzzle-feedback {
            font-size: 16px;
            color: #ddd;
            width: 60%;
            min-height: 40px;
            display: flex;
            align-items: center;
        }
        .game-color-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
            border: 1px solid #fff;
            box-shadow: 0 0 3px rgba(255,255,255,0.5);
        }
        .game-dot-green { 
            background-color: #0f0; 
            box-shadow: 0 0 5px #0f0;
        }
        .game-dot-yellow { 
            background-color: #ffcc00; 
            box-shadow: 0 0 5px #ffcc00;
        }
        .game-dot-red { 
            background-color: #f00; 
            box-shadow: 0 0 5px #f00;
        }
        
        .game-typewriter-text::after {
            content: '|';
            animation: blink 1s infinite;
            color: #ffcc00;
            font-weight: bold;
        }
        
        .game-scene-transition {
            animation: fadeIn 0.5s ease;
        }
        
        .game-historical-note {
            background: rgba(20, 20, 30, 0.8);
            border-left: 3px solid #ffcc00;
            padding: 10px 15px;
            margin: 10px 0;
            font-style: italic;
            color: #aaa;
            font-size: 14px;
        }
        
        /* é€šç”¨æ ·å¼ */
        @keyframes flash {
            0% { background-color: #1a1f0d; }
            50% { background-color: #5a5a2a; }
            100% { background-color: #1a1f0d; }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        
        @keyframes radar-sweep {
            0% {
                transform: translateX(-50%) rotate(0deg);
            }
            100% {
                transform: translateX(-50%) rotate(360deg);
            }
        }
        
        .military-elements {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: -1;
        }
        
        .radar {
            position: absolute;
            top: 10%;
            right: 10%;
            width: 120px;
            height: 120px;
            border: 2px solid #5a5a2a;
            border-radius: 50%;
            opacity: 0.3;
        }
        
        .radar::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background-color: #9e9466;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .radar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 50%;
            background: linear-gradient(to bottom, transparent, #9e9466);
            transform-origin: bottom center;
            animation: radar-sweep 4s linear infinite;
        }
        
        .code-snippet {
            position: absolute;
            bottom: 10%;
            left: 5%;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #5a5a2a;
            opacity: 0.5;
        }
        
        .binoculars {
            position: absolute;
            bottom: 15%;
            right: 5%;
            width: 80px;
            height: 40px;
            border: 2px solid #5a5a2a;
            border-radius: 50%;
            opacity: 0.3;
        }
        
        .binoculars::before, .binoculars::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 30px;
            height: 30px;
            border: 2px solid #5a5a2a;
            border-radius: 50%;
            transform: translateY(-50%);
        }
        
        .binoculars::before {
            left: 5px;
        }
        
        .binoculars::after {
            right: 5px;
        }
        
        footer {
            margin-top: 60px;
            text-align: center;
            font-size: 0.8rem;
            color: #5a5a2a;
            width: 100%;
            padding: 20px 0;
            border-top: 1px solid #2a2f15;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 3.5rem;
                letter-spacing: 4px;
            }
            
            .buttons-container {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                min-width: 280px;
            }
            
            .radar, .binoculars {
                display: none;
            }
            
            .enigma-keyboard-lampboard {
                flex-direction: column;
            }
            
            .enigma-input-output {
                flex-direction: column;
            }
            
            .mission-levels-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .game-terminal {
                height: 500px;
            }
            
            .game-character {
                height: 300px;
            }
            
            .game-char-left { 
                left: 20px; 
            }
            .game-char-right { 
                right: 20px; 
            }
            
            .game-puzzle-box {
                flex-direction: column;
                gap: 15px;
            }
            
            .game-puzzle-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="military-elements">
        <div class="radar"></div>
        <div class="binoculars"></div>
        <div class="code-snippet">01001101 COOKIE  01101001 COOKIE  01110011 COOKIE 01101001 COOKIE  01101111 COOKIE  01101110 COOKIE  00100000 COOKIE  01010011 COOKIE  01110100 COOKIE  01100001 COOKIE  01110010 01110100</div>
    </div>
    
    <!-- ä¸»é¡µé¢ -->
    <div class="container" id="main-page">
        <header>
            <h1>å°‘å¹´ç‰¹å·¥</h1>
            <p class="subtitle">ç²¾è‹±å¯†ç å·¥å…·é›† & äº’åŠ¨è°æˆ˜æ¸¸æˆ - ä¸“ä¸ºç‰¹å·¥ä»»åŠ¡è®¾è®¡</p>
        </header>
        
        <div class="buttons-container">
            <button class="btn" id="morse-btn">
                <span class="btn-icon">â€” â€¢ â€” â€¢</span>
                æ‘©æ–¯ç”µç 
                <div class="btn-description">äºŒæˆ˜ç›Ÿå†›é€šä¿¡å¯†ç ç³»ç»Ÿ<br>é€šè¿‡ç‚¹å’Œåˆ’ä¼ é€’ç§˜å¯†ä¿¡æ¯</div>
            </button>
            
            <button class="btn" id="caesar-btn">
                <span class="btn-icon">A â†’ D</span>
                å‡¯æ’’å¯†ç 
                <div class="btn-description">å¤ç½—é©¬ç»å…¸æ›¿æ¢å¯†ç <br>é€šè¿‡å­—æ¯ç§»ä½å®ç°åŠ å¯†</div>
            </button>
            
            <button class="btn" id="enigma-btn">
                <span class="btn-icon">A â†’ K</span>
                æ©å°¼æ ¼ç›æœº
                <div class="btn-description">å¾·å†›é«˜çº§åŠ å¯†è®¾å¤‡<br>å¤šè½¬å­ç³»ç»Ÿå¤æ‚åŠ å¯†</div>
            </button>
            
            <!-- æ–°å¢æ¸¸æˆæŒ‰é’® -->
            <button class="btn" id="game-btn">
                <span class="btn-icon">ğŸ®</span>
                å¤œèºè¡ŒåŠ¨
                <div class="btn-description">äº’åŠ¨å¼äºŒæˆ˜è°æˆ˜æ¸¸æˆ<br>æ‰®æ¼”ç‰¹å·¥å®Œæˆæœºå¯†ä»»åŠ¡</div>
            </button>
            
            <!-- ç‰¹å·¥ä»»åŠ¡æŒ‰é’® -->
            <button class="btn" id="mission-btn">
                <span class="btn-icon">â˜…â˜…â˜…</span>
                ç‰¹å·¥ä»»åŠ¡
                <div class="btn-description">18å…³å¯†ç ç ´è¯‘æŒ‘æˆ˜<br>å®Œæˆæ‰€æœ‰ä»»åŠ¡è·å–æ¯•ä¸šè¯ä¹¦</div>
            </button>
        </div>
        
        <footer>
            <p>å°‘å¹´ç‰¹å·¥-COOKIEå¯†ç ç³»ç»Ÿ | æœºå¯†ç­‰çº§ï¼šæœ€é«˜ | ä»…ä¾›æˆæƒäººå‘˜ä½¿ç”¨</p>
        </footer>
    </div>
    
    <!-- æ‘©æ–¯ç”µç å·¥å…· -->
    <div class="tool-container" id="morse-tool">
        <button class="back-btn" id="morse-back-btn">è¿”å›</button>
        <div class="tool-header">
            <h2 class="tool-title">æ‘©æ–¯ç”µç è½¬æ¢å™¨</h2>
            <p class="tool-subtitle">äºŒæˆ˜ç›Ÿå†›é€šä¿¡è®¾å¤‡æ¨¡æ‹Ÿå™¨</p>
        </div>
        
        <div class="morse-input-section">
            <div class="morse-input-group">
                <label for="morse-text-input" class="morse-label">è¾“å…¥å­—æ¯æˆ–å•è¯ï¼š</label>
                <input type="text" id="morse-text-input" class="morse-input" placeholder="è¾“å…¥æ–‡æœ¬..." maxlength="30">
                
                <div class="morse-output" id="morse-output">
                    <!-- æ‘©æ–¯ç”µç å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                
                <div class="morse-controls">
                    <button class="morse-btn" id="morse-convert-btn">è½¬æ¢</button>
                    <button class="morse-btn" id="morse-play-btn">æ’­æ”¾å£°éŸ³ <span class="morse-sound-indicator"></span></button>
                    <button class="morse-btn" id="morse-clear-btn">æ¸…é™¤</button>
                </div>
            </div>
        </div>
        
        <div class="morse-reference">
            <h2>æ‘©æ–¯ç”µç å‚è€ƒè¡¨</h2>
            <div class="morse-reference-grid" id="morse-reference-grid">
                <!-- å‚è€ƒè¡¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- å‡¯æ’’å¯†ç å·¥å…· -->
    <div class="tool-container" id="caesar-tool">
        <button class="back-btn" id="caesar-back-btn">è¿”å›</button>
        <div class="tool-header">
            <h2 class="tool-title">å‡¯æ’’å¯†ç è½¬æ¢å™¨</h2>
            <p class="tool-subtitle">å¤ç½—é©¬ç»å…¸æ›¿æ¢å¯†ç ç³»ç»Ÿ</p>
        </div>
        
        <div class="caesar-tabs">
            <div class="caesar-tab active" data-tab="encrypt">åŠ å¯†</div>
            <div class="caesar-tab" data-tab="decrypt">è§£å¯†</div>
        </div>
        
        <div class="caesar-tab-content active" id="caesar-encrypt-tab">
            <div class="caesar-input-group">
                <label for="caesar-plaintext" class="caesar-label">è¾“å…¥åŸæ–‡ï¼š</label>
                <textarea id="caesar-plaintext" class="caesar-textarea" placeholder="è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬..."></textarea>
            </div>
            
            <div class="caesar-input-group">
                <label for="caesar-encrypt-key" class="caesar-label">å¯†é’¥ (1-25)ï¼š</label>
                <input type="number" id="caesar-encrypt-key" class="caesar-key-input" min="1" max="25" value="3">
                <p class="caesar-warning">æ³¨æ„ï¼šå¯†é’¥å¿…é¡»æ˜¯1åˆ°25ä¹‹é—´çš„æ•´æ•°</p>
            </div>
            
            <div class="caesar-output" id="caesar-ciphertext-output">
                <!-- åŠ å¯†ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <div class="caesar-controls">
                <button class="caesar-btn" id="caesar-encrypt-btn">åŠ å¯†</button>
                <button class="caesar-btn" id="caesar-copy-encrypt-btn">å¤åˆ¶ç»“æœ</button>
                <button class="caesar-btn" id="caesar-clear-encrypt-btn">æ¸…é™¤</button>
            </div>
        </div>
        
        <div class="caesar-tab-content" id="caesar-decrypt-tab">
            <div class="caesar-input-group">
                <label for="caesar-ciphertext" class="caesar-label">è¾“å…¥å¯†æ–‡ï¼š</label>
                <textarea id="caesar-ciphertext" class="caesar-textarea" placeholder="è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬..."></textarea>
            </div>
            
            <div class="caesar-input-group">
                <label for="caesar-decrypt-key" class="caesar-label">å¯†é’¥ (1-25)ï¼š</label>
                <input type="number" id="caesar-decrypt-key" class="caesar-key-input" min="1" max="25" value="3">
                <p class="caesar-warning">æ³¨æ„ï¼šå¯†é’¥å¿…é¡»æ˜¯1åˆ°25ä¹‹é—´çš„æ•´æ•°</p>
            </div>
            
            <div class="caesar-output" id="caesar-plaintext-output">
                <!-- è§£å¯†ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <div class="caesar-controls">
                <button class="caesar-btn" id="caesar-decrypt-btn">è§£å¯†</button>
                <button class="caesar-btn" id="caesar-copy-decrypt-btn">å¤åˆ¶ç»“æœ</button>
                <button class="caesar-btn" id="caesar-clear-decrypt-btn">æ¸…é™¤</button>
            </div>
        </div>
        
        <div class="caesar-reference">
            <h2>å‡¯æ’’å¯†ç å‚è€ƒ</h2>
            <div class="caesar-reference-content">
                <p>å‡¯æ’’å¯†ç æ˜¯ä¸€ç§æ›¿æ¢åŠ å¯†æŠ€æœ¯ï¼Œæ®ä¼ ç”±å¤ç½—é©¬å†›äº‹é¢†è¢–å‡¯æ’’ä½¿ç”¨ï¼Œé€šè¿‡å°†å­—æ¯æŒ‰ç…§å›ºå®šä½ç½®è¿›è¡Œåç§»æ¥å®ç°åŠ å¯†ã€‚</p>
                <p>ä¾‹å¦‚ï¼Œå½“å¯†é’¥ä¸º3æ—¶ï¼š</p>
                <p>åŸæ–‡: A B C D ... X Y Z</p>
                <p>å¯†æ–‡: D E F G ... A B C</p>
                <p>åœ¨äºŒæˆ˜æœŸé—´ï¼Œè¿™ç§ç®€å•çš„åŠ å¯†æ–¹å¼è¢«ç”¨äºä½çº§æœºå¯†é€šä¿¡ï¼Œé€šå¸¸ä¸å…¶ä»–åŠ å¯†æ–¹æ³•ç»“åˆä½¿ç”¨ã€‚</p>
            </div>
        </div>
    </div>
    
    <!-- æ©å°¼æ ¼ç›å¯†ç æœºå·¥å…· -->
    <div class="tool-container" id="enigma-tool">
        <button class="back-btn" id="enigma-back-btn">è¿”å›</button>
        <div class="tool-header">
            <h2 class="tool-title">æ©å°¼æ ¼ç›å¯†ç æœº</h2>
            <p class="tool-subtitle">å¾·å›½å›½é˜²å†›Enigma Iå‹æ¨¡æ‹Ÿå™¨</p>
        </div>
        
        <div class="enigma-rotors-section">
            <div class="enigma-rotors-title">è½¬å­è®¾ç½®</div>
            <div class="enigma-rotors-container">
                <div class="enigma-rotor">
                    <div class="enigma-rotor-label">è½¬å­ I</div>
                    <div class="enigma-rotor-display" id="enigma-rotor1">A</div>
                    <div class="enigma-rotor-controls">
                        <button class="enigma-rotor-btn" data-rotor="1" data-direction="-1">-</button>
                        <button class="enigma-rotor-btn" data-rotor="1" data-direction="1">+</button>
                    </div>
                </div>
                <div class="enigma-rotor">
                    <div class="enigma-rotor-label">è½¬å­ II</div>
                    <div class="enigma-rotor-display" id="enigma-rotor2">A</div>
                    <div class="enigma-rotor-controls">
                        <button class="enigma-rotor-btn" data-rotor="2" data-direction="-1">-</button>
                        <button class="enigma-rotor-btn" data-rotor="2" data-direction="1">+</button>
                    </div>
                </div>
                <div class="enigma-rotor">
                    <div class="enigma-rotor-label">è½¬å­ III</div>
                    <div class="enigma-rotor-display" id="enigma-rotor3">A</div>
                    <div class="enigma-rotor-controls">
                        <button class="enigma-rotor-btn" data-rotor="3" data-direction="-1">-</button>
                        <button class="enigma-rotor-btn" data-rotor="3" data-direction="1">+</button>
                    </div>
                </div>
            </div>
            <div class="enigma-status" id="enigma-rotor-status">è½¬å­ä½ç½®: I-A, II-A, III-A</div>
        </div>
        
        <div class="enigma-plugboard-section">
            <div class="enigma-plugboard-title">æ’çº¿æ¿</div>
            <div class="enigma-plugboard">
                <div class="enigma-plug">
                    <div class="enigma-plug-letter">A</div>
                    <div class="enigma-plug-cable"></div>
                    <div class="enigma-plug-letter">B</div>
                </div>
                <div class="enigma-plug">
                    <div class="enigma-plug-letter">C</div>
                    <div class="enigma-plug-cable"></div>
                    <div class="enigma-plug-letter">D</div>
                </div>
                <div class="enigma-plug">
                    <div class="enigma-plug-letter">E</div>
                    <div class="enigma-plug-cable"></div>
                    <div class="enigma-plug-letter">F</div>
                </div>
                <div class="enigma-plug">
                    <div class="enigma-plug-letter">G</div>
                    <div class="enigma-plug-cable"></div>
                    <div class="enigma-plug-letter">H</div>
                </div>
                <div class="enigma-plug">
                    <div class="enigma-plug-letter">I</div>
                    <div class="enigma-plug-cable"></div>
                    <div class="enigma-plug-letter">J</div>
                </div>
            </div>
            <div class="enigma-status">æ’çº¿æ¿è¿æ¥: A-B, C-D, E-F, G-H, I-J</div>
        </div>
        
        <div class="enigma-keyboard-lampboard">
            <div class="enigma-lampboard">
                <div class="enigma-section-title">ç¯ç›˜</div>
                <div class="enigma-lamp-grid" id="enigma-lamp-grid">
                    <!-- ç¯ç›˜å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="enigma-keyboard">
                <div class="enigma-section-title">é”®ç›˜</div>
                <div class="enigma-key-grid" id="enigma-key-grid">
                    <!-- é”®ç›˜å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <div class="enigma-input-output">
            <div class="enigma-input-area">
                <div class="enigma-section-title">è¾“å…¥</div>
                <textarea id="enigma-input-text" class="enigma-textarea" placeholder="è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬..."></textarea>
                <div class="enigma-controls">
                    <button class="enigma-btn" id="enigma-encrypt-btn">åŠ å¯†æ–‡æœ¬</button>
                    <button class="enigma-btn" id="enigma-clear-input-btn">æ¸…é™¤</button>
                </div>
            </div>
            
            <div class="enigma-output-area">
                <div class="enigma-section-title">è¾“å‡º</div>
                <textarea id="enigma-output-text" class="enigma-textarea" placeholder="åŠ å¯†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
                <div class="enigma-controls">
                    <button class="enigma-btn" id="enigma-decrypt-btn">è§£å¯†æ–‡æœ¬</button>
                    <button class="enigma-btn" id="enigma-clear-output-btn">æ¸…é™¤</button>
                </div>
            </div>
        </div>
        
        <div class="enigma-history">
            <div class="enigma-history-title">åŠ å¯†å†å²</div>
            <div id="enigma-history-list">
                <!-- å†å²è®°å½•å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- æ¸¸æˆå®¹å™¨ -->
    <div class="game-container" id="game-tool">
        <button class="back-btn" id="game-back-btn">è¿”å›</button>
        <div class="tool-header">
            <h2 class="tool-title">å¤œèºè¡ŒåŠ¨</h2>
            <p class="tool-subtitle">äº’åŠ¨å¼äºŒæˆ˜è°æˆ˜æ¸¸æˆ - æ‰®æ¼”ç‰¹å·¥å®Œæˆæœºå¯†ä»»åŠ¡</p>
        </div>
        
        <div class="game-terminal">
            <div class="game-viewport" id="game-viewport">
                <div class="game-overlay"></div>
                
                <img id="game-char-left" class="game-character game-char-left" src="" alt="å·¦äººç‰©" onerror="this.style.display='none'">
                <img id="game-char-right" class="game-character game-char-right" src="" alt="å³äººç‰©" onerror="this.style.display='none'">
            </div>

            <div class="game-interface">
                <div class="game-speaker-box" id="game-speaker-box">SYSTEM</div>
                <div class="game-text-box"><span id="game-typewriter-text"></span></div>
                
                <div class="game-puzzle-box" id="game-puzzle-box">
                    <span id="game-puzzle-feedback">è¯·è¾“å…¥4ä½å¯†ç ...</span>
                    <div>
                        <input type="text" id="game-puzzle-input" maxlength="4" autocomplete="off" placeholder="4ä½æ•°å­—" pattern="[0-9]*">
                        <button class="game-btn" id="game-puzzle-submit-btn">ç¡®å®š</button>
                    </div>
                </div>

                <div class="game-controls" id="game-controls">
                    <!-- æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç‰¹å·¥ä»»åŠ¡å·¥å…· -->
    <div class="mission-container" id="mission-tool">
        <button class="back-btn" id="mission-back-btn">è¿”å›</button>
        <div class="tool-header">
            <h2 class="tool-title">ç‰¹å·¥ä»»åŠ¡</h2>
            <p class="tool-subtitle">18å…³å¯†ç ç ´è¯‘æŒ‘æˆ˜ - è¯æ˜ä½ çš„ç‰¹å·¥æŠ€èƒ½</p>
        </div>
        
        <div class="mission-tabs">
            <div class="mission-tab active" data-tab="levels">å…³å¡é€‰æ‹©</div>
            <div class="mission-tab" data-tab="certificate">æ¯•ä¸šè¯ä¹¦</div>
        </div>
        
        <div class="mission-tab-content active" id="mission-levels-tab">
            <div class="progress-text">ä»»åŠ¡è¿›åº¦: <span id="mission-progress-text">0/18</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="mission-progress-fill" style="width: 0%"></div>
            </div>
            
            <div class="mission-levels-grid" id="mission-levels-grid">
                <!-- å…³å¡å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
            
            <div class="mission-details" id="mission-details">
                <div class="mission-details-title">é€‰æ‹©å…³å¡å¼€å§‹ä»»åŠ¡</div>
                <div class="mission-details-description">
                    ç‚¹å‡»å·¦ä¾§çš„å…³å¡å¡ç‰‡æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…å¹¶å¼€å§‹æŒ‘æˆ˜ã€‚æ¯å®Œæˆä¸€ä¸ªå…³å¡ï¼Œä¸‹ä¸€ä¸ªå…³å¡å°†è‡ªåŠ¨è§£é”ã€‚
                </div>
            </div>
        </div>
        
        <div class="mission-tab-content" id="mission-certificate-tab">
            <div class="certificate-container" id="certificate-container">
                <div class="certificate-title">ç‰¹å·¥æ¯•ä¸šè¯ä¹¦</div>
                <div class="certificate-subtitle">å°‘å¹´ç‰¹å·¥å¯†ç ç ´è¯‘ä¸“å®¶</div>
                
                <div class="certificate-content">
                    å…¹è¯æ˜ <strong id="certificate-agent-name">[ç‰¹å·¥å§“å]</strong> å·²å®Œæˆå…¨éƒ¨18é¡¹å¯†ç ç ´è¯‘ä»»åŠ¡ï¼Œ<br>
                    å±•ç°äº†å“è¶Šçš„å¯†ç å­¦æŠ€èƒ½å’Œç‰¹å·¥ç´ è´¨ï¼Œ<br>
                    ç‰¹æˆäºˆæ­¤è¯ä¹¦ä»¥èµ„è¡¨å½°ã€‚
                </div>
                
                <div class="certificate-seal">
                    å°‘å¹´ç‰¹å·¥
                </div>
                
                <div class="certificate-content">
                    é¢å‘æ—¥æœŸ: <span id="certificate-date">[æ—¥æœŸ]</span><br>
                    è¯ä¹¦ç¼–å·: <span id="certificate-id">[ç¼–å·]</span>
                </div>
                
                <button class="certificate-download" id="certificate-download-btn">ä¸‹è½½è¯ä¹¦</button>
            </div>
            
            <div class="mission-details" id="certificate-locked">
                <div class="mission-details-title">æ¯•ä¸šè¯ä¹¦å°šæœªè§£é”</div>
                <div class="mission-details-description">
                    å®Œæˆå…¨éƒ¨18ä¸ªç‰¹å·¥ä»»åŠ¡åï¼Œä½ å°†è·å¾—å°‘å¹´ç‰¹å·¥æ¯•ä¸šè¯ä¹¦ã€‚<br>
                    ç»§ç»­åŠªåŠ›ï¼Œè¯æ˜ä½ çš„å¯†ç ç ´è¯‘èƒ½åŠ›ï¼
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== é¡µé¢å¯¼èˆªåŠŸèƒ½ ====================
        const mainPage = document.getElementById('main-page');
        const morseTool = document.getElementById('morse-tool');
        const caesarTool = document.getElementById('caesar-tool');
        const enigmaTool = document.getElementById('enigma-tool');
        const gameTool = document.getElementById('game-tool');
        const missionTool = document.getElementById('mission-tool');
        
        const morseBtn = document.getElementById('morse-btn');
        const caesarBtn = document.getElementById('caesar-btn');
        const enigmaBtn = document.getElementById('enigma-btn');
        const gameBtn = document.getElementById('game-btn');
        const missionBtn = document.getElementById('mission-btn');
        
        const morseBackBtn = document.getElementById('morse-back-btn');
        const caesarBackBtn = document.getElementById('caesar-back-btn');
        const enigmaBackBtn = document.getElementById('enigma-back-btn');
        const gameBackBtn = document.getElementById('game-back-btn');
        const missionBackBtn = document.getElementById('mission-back-btn');
        
        // æ˜¾ç¤ºæŒ‡å®šå·¥å…·ï¼Œéšè—å…¶ä»–
        function showTool(tool) {
            mainPage.style.display = 'none';
            morseTool.classList.remove('active');
            caesarTool.classList.remove('active');
            enigmaTool.classList.remove('active');
            gameTool.classList.remove('active');
            missionTool.classList.remove('active');
            
            if (tool === 'morse') {
                morseTool.classList.add('active');
            } else if (tool === 'caesar') {
                caesarTool.classList.add('active');
            } else if (tool === 'enigma') {
                enigmaTool.classList.add('active');
            } else if (tool === 'game') {
                gameTool.classList.add('active');
                // å»¶è¿Ÿåˆå§‹åŒ–æ¸¸æˆï¼Œç¡®ä¿DOMå·²åŠ è½½
                setTimeout(() => {
                    if (typeof NightingaleGame !== 'undefined') {
                        NightingaleGame.init();
                    }
                }, 100);
            } else if (tool === 'mission') {
                missionTool.classList.add('active');
                // åˆå§‹åŒ–ä»»åŠ¡ç³»ç»Ÿ
                initMissions();
            }
        }
        
        // è¿”å›ä¸»é¡µé¢
        function backToMain() {
            mainPage.style.display = 'flex';
            morseTool.classList.remove('active');
            caesarTool.classList.remove('active');
            enigmaTool.classList.remove('active');
            gameTool.classList.remove('active');
            missionTool.classList.remove('active');
        }
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        morseBtn.addEventListener('click', () => showTool('morse'));
        caesarBtn.addEventListener('click', () => showTool('caesar'));
        enigmaBtn.addEventListener('click', () => showTool('enigma'));
        gameBtn.addEventListener('click', () => showTool('game'));
        missionBtn.addEventListener('click', () => showTool('mission'));
        
        morseBackBtn.addEventListener('click', backToMain);
        caesarBackBtn.addEventListener('click', backToMain);
        enigmaBackBtn.addEventListener('click', backToMain);
        gameBackBtn.addEventListener('click', backToMain);
        missionBackBtn.addEventListener('click', backToMain);
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(event) {
            if (mainPage.style.display !== 'none') {
                switch(event.key) {
                    case '1':
                        morseBtn.click();
                        break;
                    case '2':
                        caesarBtn.click();
                        break;
                    case '3':
                        enigmaBtn.click();
                        break;
                    case '4':
                        gameBtn.click();
                        break;
                    case '5':
                        missionBtn.click();
                        break;
                }
            }
        });
        
        // ==================== æ‘©æ–¯ç”µç åŠŸèƒ½ ====================
        const morseCodeMap = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 
            'Y': '-.--', 'Z': '--..', '0': '-----', '1': '.----', '2': '..---', 
            '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...', 
            '8': '---..', '9': '----.', '.': '.-.-.-', ',': '--..--', '?': '..--..', 
            "'": '.----.', '!': '-.-.--', '/': '-..-.', '(': '-.--.', ')': '-.--.-', 
            '&': '.-...', ':': '---...', ';': '-.-.-.', '=': '-...-', '+': '.-.-.', 
            '-': '-....-', '_': '..--.-', '"': '.-..-.', '$': '...-..-', '@': '.--.-.',
            ' ': '/'
        };

        // æ‘©æ–¯ç”µç DOMå…ƒç´ 
        const morseTextInput = document.getElementById('morse-text-input');
        const morseOutput = document.getElementById('morse-output');
        const morseConvertBtn = document.getElementById('morse-convert-btn');
        const morsePlayBtn = document.getElementById('morse-play-btn');
        const morseClearBtn = document.getElementById('morse-clear-btn');
        const morseReferenceGrid = document.getElementById('morse-reference-grid');
        const morseSoundIndicator = document.querySelector('.morse-sound-indicator');

        // éŸ³é¢‘ä¸Šä¸‹æ–‡
        let morseAudioContext;
        let morseIsPlaying = false;
        let morseCurrentOscillator = null;

        // åˆå§‹åŒ–æ‘©æ–¯ç”µç å‚è€ƒè¡¨
        function initMorseReferenceTable() {
            for (const [char, code] of Object.entries(morseCodeMap)) {
                const item = document.createElement('div');
                item.className = 'morse-reference-item';
                item.innerHTML = `<div class="morse-char">${char}</div><div class="morse-code">${code}</div>`;
                morseReferenceGrid.appendChild(item);
            }
        }

        // æ–‡æœ¬è½¬æ¢ä¸ºæ‘©æ–¯ç”µç 
        function textToMorse(text) {
            return text.toUpperCase().split('').map(char => {
                return morseCodeMap[char] || '';
            }).join(' ');
        }

        // æ‘©æ–¯ç”µç è½¬æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        morseConvertBtn.addEventListener('click', () => {
            const text = morseTextInput.value;
            const morse = textToMorse(text);
            morseOutput.textContent = morse;
            morseOutput.classList.add('morse-flash');
            setTimeout(() => morseOutput.classList.remove('morse-flash'), 500);
        });

        // æ‘©æ–¯ç”µç æ¸…é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        morseClearBtn.addEventListener('click', () => {
            morseTextInput.value = '';
            morseOutput.textContent = '';
            if (morseIsPlaying) {
                stopMorseSound();
            }
        });

        // æ’­æ”¾æ‘©æ–¯ç”µç å£°éŸ³
        function playMorseSound(morse) {
            if (!morseAudioContext) {
                morseAudioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            morseIsPlaying = true;
            morseSoundIndicator.classList.add('active');
            morsePlayBtn.disabled = true;
            
            const dotDuration = 100; // ç‚¹çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            const dashDuration = dotDuration * 3; // åˆ’çš„æ—¶é—´
            const symbolGap = dotDuration; // ç¬¦å·é—´éš”
            const letterGap = dotDuration * 3; // å­—æ¯é—´éš”
            const wordGap = dotDuration * 7; // å•è¯é—´éš”
            
            let time = morseAudioContext.currentTime;
            
            morse.split('').forEach(symbol => {
                switch(symbol) {
                    case '.':
                        // æ’­æ”¾ç‚¹
                        playMorseBeep(time, dotDuration);
                        time += dotDuration / 1000 + symbolGap / 1000;
                        break;
                    case '-':
                        // æ’­æ”¾åˆ’
                        playMorseBeep(time, dashDuration);
                        time += dashDuration / 1000 + symbolGap / 1000;
                        break;
                    case ' ':
                        // å­—æ¯é—´éš”
                        time += (letterGap - symbolGap) / 1000;
                        break;
                    case '/':
                        // å•è¯é—´éš”
                        time += (wordGap - symbolGap) / 1000;
                        break;
                }
            });
            
            // æ’­æ”¾å®Œæˆåé‡ç½®æŒ‰é’®çŠ¶æ€
            setTimeout(() => {
                morseIsPlaying = false;
                morseSoundIndicator.classList.remove('active');
                morsePlayBtn.disabled = false;
            }, time * 1000 - morseAudioContext.currentTime * 1000 + 100);
        }

        // æ’­æ”¾æ‘©æ–¯ç”µç å•éŸ³
        function playMorseBeep(startTime, duration) {
            const oscillator = morseAudioContext.createOscillator();
            const gainNode = morseAudioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(morseAudioContext.destination);
            
            oscillator.frequency.value = 700; // é¢‘ç‡
            oscillator.type = 'sine'; // æ³¢å½¢
            
            gainNode.gain.setValueAtTime(0.3, startTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration / 1000);
            
            oscillator.start(startTime);
            oscillator.stop(startTime + duration / 1000);
            
            morseCurrentOscillator = oscillator;
        }

        // åœæ­¢æ’­æ”¾æ‘©æ–¯ç”µç å£°éŸ³
        function stopMorseSound() {
            if (morseCurrentOscillator) {
                morseCurrentOscillator.stop();
                morseCurrentOscillator = null;
            }
            morseIsPlaying = false;
            morseSoundIndicator.classList.remove('active');
            morsePlayBtn.disabled = false;
        }

        // æ‘©æ–¯ç”µç æ’­æ”¾æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        morsePlayBtn.addEventListener('click', () => {
            if (morseIsPlaying) {
                stopMorseSound();
            } else {
                const morse = morseOutput.textContent;
                if (morse) {
                    playMorseSound(morse);
                }
            }
        });

        // åˆå§‹åŒ–æ‘©æ–¯ç”µç 
        document.addEventListener('DOMContentLoaded', () => {
            initMorseReferenceTable();
            
            // è¾“å…¥æ—¶å®æ—¶è½¬æ¢
            morseTextInput.addEventListener('input', () => {
                const text = morseTextInput.value;
                const morse = textToMorse(text);
                morseOutput.textContent = morse;
            });
        });
        
        // ==================== å‡¯æ’’å¯†ç åŠŸèƒ½ ====================
        // å‡¯æ’’å¯†ç DOMå…ƒç´ 
        const caesarTabs = document.querySelectorAll('.caesar-tab');
        const caesarTabContents = document.querySelectorAll('.caesar-tab-content');
        const caesarPlaintextInput = document.getElementById('caesar-plaintext');
        const caesarCiphertextInput = document.getElementById('caesar-ciphertext');
        const caesarEncryptKeyInput = document.getElementById('caesar-encrypt-key');
        const caesarDecryptKeyInput = document.getElementById('caesar-decrypt-key');
        const caesarCiphertextOutput = document.getElementById('caesar-ciphertext-output');
        const caesarPlaintextOutput = document.getElementById('caesar-plaintext-output');
        const caesarEncryptBtn = document.getElementById('caesar-encrypt-btn');
        const caesarDecryptBtn = document.getElementById('caesar-decrypt-btn');
        const caesarCopyEncryptBtn = document.getElementById('caesar-copy-encrypt-btn');
        const caesarCopyDecryptBtn = document.getElementById('caesar-copy-decrypt-btn');
        const caesarClearEncryptBtn = document.getElementById('caesar-clear-encrypt-btn');
        const caesarClearDecryptBtn = document.getElementById('caesar-clear-decrypt-btn');

        // å‡¯æ’’å¯†ç æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        caesarTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // ç§»é™¤æ‰€æœ‰æ ‡ç­¾å’Œå†…å®¹çš„activeç±»
                caesarTabs.forEach(t => t.classList.remove('active'));
                caesarTabContents.forEach(content => content.classList.remove('active'));
                
                // æ·»åŠ å½“å‰æ ‡ç­¾å’Œå†…å®¹çš„activeç±»
                tab.classList.add('active');
                document.getElementById(`caesar-${tabId}-tab`).classList.add('active');
            });
        });

        // å‡¯æ’’å¯†ç åŠ å¯†å‡½æ•°
        function caesarEncrypt(text, key) {
            key = parseInt(key) % 26;
            if (key === 0) return text;
            
            return text.split('').map(char => {
                if (char.match(/[a-z]/i)) {
                    const code = char.charCodeAt(0);
                    const isUpperCase = (code >= 65 && code <= 90);
                    const base = isUpperCase ? 65 : 97;
                    
                    // åº”ç”¨å‡¯æ’’ç§»ä½
                    let shiftedCode = ((code - base + key) % 26) + base;
                    if (shiftedCode < base) shiftedCode += 26;
                    
                    return String.fromCharCode(shiftedCode);
                }
                return char;
            }).join('');
        }

        // å‡¯æ’’å¯†ç è§£å¯†å‡½æ•°
        function caesarDecrypt(text, key) {
            key = parseInt(key) % 26;
            if (key === 0) return text;
            
            return text.split('').map(char => {
                if (char.match(/[a-z]/i)) {
                    const code = char.charCodeAt(0);
                    const isUpperCase = (code >= 65 && code <= 90);
                    const base = isUpperCase ? 65 : 97;
                    
                    // åº”ç”¨å‡¯æ’’ç§»ä½ï¼ˆåå‘ï¼‰
                    let shiftedCode = ((code - base - key) % 26) + base;
                    if (shiftedCode < base) shiftedCode += 26;
                    
                    return String.fromCharCode(shiftedCode);
                }
                return char;
            }).join('');
        }

        // å‡¯æ’’å¯†ç åŠ å¯†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        caesarEncryptBtn.addEventListener('click', () => {
            const text = caesarPlaintextInput.value;
            const key = caesarEncryptKeyInput.value;
            
            if (!text) {
                caesarCiphertextOutput.textContent = "è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬";
                return;
            }
            
            if (key < 1 || key > 25) {
                caesarCiphertextOutput.textContent = "å¯†é’¥å¿…é¡»æ˜¯1åˆ°25ä¹‹é—´çš„æ•´æ•°";
                return;
            }
            
            const encrypted = caesarEncrypt(text, key);
            caesarCiphertextOutput.textContent = encrypted;
            caesarCiphertextOutput.classList.add('caesar-flash');
            setTimeout(() => caesarCiphertextOutput.classList.remove('caesar-flash'), 500);
        });

        // å‡¯æ’’å¯†ç è§£å¯†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        caesarDecryptBtn.addEventListener('click', () => {
            const text = caesarCiphertextInput.value;
            const key = caesarDecryptKeyInput.value;
            
            if (!text) {
                caesarPlaintextOutput.textContent = "è¯·è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬";
                return;
            }
            
            if (key < 1 || key > 25) {
                caesarPlaintextOutput.textContent = "å¯†é’¥å¿…é¡»æ˜¯1åˆ°25ä¹‹é—´çš„æ•´æ•°";
                return;
            }
            
            const decrypted = caesarDecrypt(text, key);
            caesarPlaintextOutput.textContent = decrypted;
            caesarPlaintextOutput.classList.add('caesar-flash');
            setTimeout(() => caesarPlaintextOutput.classList.remove('caesar-flash'), 500);
        });

        // å‡¯æ’’å¯†ç å¤åˆ¶åŠ å¯†ç»“æœ
        caesarCopyEncryptBtn.addEventListener('click', () => {
            const text = caesarCiphertextOutput.textContent;
            if (text && text !== "è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬" && text !== "å¯†é’¥å¿…é¡»æ˜¯1åˆ°25ä¹‹é—´çš„æ•´æ•°") {
                navigator.clipboard.writeText(text).then(() => {
                    const originalText = caesarCopyEncryptBtn.textContent;
                    caesarCopyEncryptBtn.textContent = "å·²å¤åˆ¶!";
                    setTimeout(() => {
                        caesarCopyEncryptBtn.textContent = originalText;
                    }, 2000);
                });
            }
        });

        // å‡¯æ’’å¯†ç å¤åˆ¶è§£å¯†ç»“æœ
        caesarCopyDecryptBtn.addEventListener('click', () => {
            const text = caesarPlaintextOutput.textContent;
            if (text && text !== "è¯·è¾“å…¥è¦è§£å¯†çš„æ–‡æœ¬" && text !== "å¯†é’¥å¿…é¡»æ˜¯1åˆ°25ä¹‹é—´çš„æ•´æ•°") {
                navigator.clipboard.writeText(text).then(() => {
                    const originalText = caesarCopyDecryptBtn.textContent;
                    caesarCopyDecryptBtn.textContent = "å·²å¤åˆ¶!";
                    setTimeout(() => {
                        caesarCopyDecryptBtn.textContent = originalText;
                    }, 2000);
                });
            }
        });

        // å‡¯æ’’å¯†ç æ¸…é™¤åŠ å¯†åŒºåŸŸ
        caesarClearEncryptBtn.addEventListener('click', () => {
            caesarPlaintextInput.value = '';
            caesarCiphertextOutput.textContent = '';
            caesarEncryptKeyInput.value = '3';
        });

        // å‡¯æ’’å¯†ç æ¸…é™¤è§£å¯†åŒºåŸŸ
        caesarClearDecryptBtn.addEventListener('click', () => {
            caesarCiphertextInput.value = '';
            caesarPlaintextOutput.textContent = '';
            caesarDecryptKeyInput.value = '3';
        });

        // å‡¯æ’’å¯†ç å®æ—¶åŠ å¯†ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
        caesarPlaintextInput.addEventListener('input', () => {
            const text = caesarPlaintextInput.value;
            const key = caesarEncryptKeyInput.value;
            
            if (text && key >= 1 && key <= 25) {
                const encrypted = caesarEncrypt(text, key);
                caesarCiphertextOutput.textContent = encrypted;
            } else if (!text) {
                caesarCiphertextOutput.textContent = '';
            }
        });

        // å‡¯æ’’å¯†ç å®æ—¶è§£å¯†ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
        caesarCiphertextInput.addEventListener('input', () => {
            const text = caesarCiphertextInput.value;
            const key = caesarDecryptKeyInput.value;
            
            if (text && key >= 1 && key <= 25) {
                const decrypted = caesarDecrypt(text, key);
                caesarPlaintextOutput.textContent = decrypted;
            } else if (!text) {
                caesarPlaintextOutput.textContent = '';
            }
        });
        
        // ==================== æ©å°¼æ ¼ç›å¯†ç æœºåŠŸèƒ½ ====================
        // æ©å°¼æ ¼ç›æœºæ¨¡æ‹Ÿ
        class EnigmaMachine {
            constructor() {
                // è½¬å­æ¥çº¿é…ç½® (å†å²å‡†ç¡®çš„æ©å°¼æ ¼ç›Iå‹è½¬å­)
                this.rotorWirings = [
                    "EKMFLGDQVZNTOWYHXUSPAIBRCJ", // è½¬å­I
                    "AJDKSIRUXBLHWTMCQGZNPYFVOE", // è½¬å­II
                    "BDFHJLCPRTXVZNYEIWGAKMUSQO", // è½¬å­III
                ];
                
                // åå°„å™¨æ¥çº¿ (å†å²å‡†ç¡®çš„æ©å°¼æ ¼ç›UKW-B)
                this.reflectorWiring = "YRUHQSLDPXNGOKMIEBFZCWVJAT";
                
                // æ’çº¿æ¿è¿æ¥
                this.plugboard = {
                    'A': 'B', 'B': 'A',
                    'C': 'D', 'D': 'C',
                    'E': 'F', 'F': 'E',
                    'G': 'H', 'H': 'G',
                    'I': 'J', 'J': 'I'
                };
                
                // è½¬å­å½“å‰ä½ç½®
                this.rotorPositions = [0, 0, 0]; // A, A, A
                
                // å­—æ¯è¡¨
                this.alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            }
            
            // è®¾ç½®è½¬å­ä½ç½®
            setRotorPosition(rotorIndex, position) {
                this.rotorPositions[rotorIndex] = position % 26;
            }
            
            // è½¬åŠ¨è½¬å­
            rotateRotors() {
                // ç¬¬ä¸€ä¸ªè½¬å­æ¯æ¬¡æŒ‰é”®éƒ½è½¬åŠ¨
                this.rotorPositions[0] = (this.rotorPositions[0] + 1) % 26;
                
                // å½“ç¬¬ä¸€ä¸ªè½¬å­å®Œæˆä¸€åœˆæ—¶ï¼Œè½¬åŠ¨ç¬¬äºŒä¸ªè½¬å­
                if (this.rotorPositions[0] === 0) {
                    this.rotorPositions[1] = (this.rotorPositions[1] + 1) % 26;
                    
                    // å½“ç¬¬äºŒä¸ªè½¬å­å®Œæˆä¸€åœˆæ—¶ï¼Œè½¬åŠ¨ç¬¬ä¸‰ä¸ªè½¬å­
                    if (this.rotorPositions[1] === 0) {
                        this.rotorPositions[2] = (this.rotorPositions[2] + 1) % 26;
                    }
                }
            }
            
            // é€šè¿‡æ’çº¿æ¿
            passThroughPlugboard(letter) {
                return this.plugboard[letter] || letter;
            }
            
            // é€šè¿‡è½¬å­ (æ­£å‘)
            passThroughRotor(letter, rotorIndex, forward) {
                const rotorWiring = this.rotorWirings[rotorIndex];
                const position = this.rotorPositions[rotorIndex];
                
                if (forward) {
                    // è¾“å…¥å­—æ¯åœ¨å­—æ¯è¡¨ä¸­çš„ä½ç½®
                    const inputIndex = this.alphabet.indexOf(letter);
                    // è€ƒè™‘è½¬å­ä½ç½®åç§»
                    const shiftedIndex = (inputIndex + position) % 26;
                    // é€šè¿‡è½¬å­æ¥çº¿
                    const outputLetter = rotorWiring[shiftedIndex];
                    // åå‘åç§»
                    const outputIndex = (this.alphabet.indexOf(outputLetter) - position + 26) % 26;
                    return this.alphabet[outputIndex];
                } else {
                    // åå‘é€šè¿‡è½¬å­
                    const inputIndex = this.alphabet.indexOf(letter);
                    // è€ƒè™‘è½¬å­ä½ç½®åç§»
                    const shiftedIndex = (inputIndex + position) % 26;
                    // æ‰¾åˆ°è½¬å­æ¥çº¿ä¸­çš„ä½ç½®
                    const wiringIndex = rotorWiring.indexOf(this.alphabet[shiftedIndex]);
                    // åå‘åç§»
                    const outputIndex = (wiringIndex - position + 26) % 26;
                    return this.alphabet[outputIndex];
                }
            }
            
            // é€šè¿‡åå°„å™¨
            passThroughReflector(letter) {
                const index = this.alphabet.indexOf(letter);
                return this.reflectorWiring[index];
            }
            
            // åŠ å¯†/è§£å¯†å•ä¸ªå­—æ¯
            processLetter(letter) {
                if (!this.alphabet.includes(letter)) return letter;
                
                // è½¬åŠ¨è½¬å­
                this.rotateRotors();
                
                // é€šè¿‡æ’çº¿æ¿ (è¾“å…¥)
                let currentLetter = this.passThroughPlugboard(letter);
                
                // é€šè¿‡ä¸‰ä¸ªè½¬å­ (æ­£å‘)
                for (let i = 0; i < 3; i++) {
                    currentLetter = this.passThroughRotor(currentLetter, i, true);
                }
                
                // é€šè¿‡åå°„å™¨
                currentLetter = this.passThroughReflector(currentLetter);
                
                // é€šè¿‡ä¸‰ä¸ªè½¬å­ (åå‘)
                for (let i = 2; i >= 0; i--) {
                    currentLetter = this.passThroughRotor(currentLetter, i, false);
                }
                
                // é€šè¿‡æ’çº¿æ¿ (è¾“å‡º)
                currentLetter = this.passThroughPlugboard(currentLetter);
                
                return currentLetter;
            }
            
            // åŠ å¯†æ–‡æœ¬
            encrypt(text) {
                let result = "";
                for (let char of text.toUpperCase()) {
                    if (this.alphabet.includes(char)) {
                        result += this.processLetter(char);
                    } else {
                        result += char;
                    }
                }
                return result;
            }
            
            // è§£å¯†æ–‡æœ¬ (æ©å°¼æ ¼ç›æ˜¯å¯¹ç§°çš„ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„è¿‡ç¨‹)
            decrypt(text) {
                return this.encrypt(text);
            }
        }

        // æ©å°¼æ ¼ç›æœºDOMå…ƒç´ 
        const enigma = new EnigmaMachine();
        const enigmaLampGrid = document.getElementById('enigma-lamp-grid');
        const enigmaKeyGrid = document.getElementById('enigma-key-grid');
        const enigmaInputText = document.getElementById('enigma-input-text');
        const enigmaOutputText = document.getElementById('enigma-output-text');
        const enigmaEncryptBtn = document.getElementById('enigma-encrypt-btn');
        const enigmaDecryptBtn = document.getElementById('enigma-decrypt-btn');
        const enigmaClearInputBtn = document.getElementById('enigma-clear-input-btn');
        const enigmaClearOutputBtn = document.getElementById('enigma-clear-output-btn');
        const enigmaRotorDisplays = [
            document.getElementById('enigma-rotor1'),
            document.getElementById('enigma-rotor2'),
            document.getElementById('enigma-rotor3')
        ];
        const enigmaRotorStatus = document.getElementById('enigma-rotor-status');
        const enigmaHistoryList = document.getElementById('enigma-history-list');

        // åˆå§‹åŒ–æ©å°¼æ ¼ç›æœºç¯ç›˜å’Œé”®ç›˜
        function initEnigmaLampsAndKeys() {
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            
            // åˆ›å»ºç¯ç›˜
            for (let letter of alphabet) {
                const lamp = document.createElement('div');
                lamp.className = 'enigma-lamp';
                lamp.textContent = letter;
                lamp.id = `enigma-lamp-${letter}`;
                enigmaLampGrid.appendChild(lamp);
            }
            
            // åˆ›å»ºé”®ç›˜
            for (let letter of alphabet) {
                const key = document.createElement('div');
                key.className = 'enigma-key';
                key.textContent = letter;
                key.id = `enigma-key-${letter}`;
                key.addEventListener('click', () => handleEnigmaKeyPress(letter));
                enigmaKeyGrid.appendChild(key);
            }
        }

        // å¤„ç†æ©å°¼æ ¼ç›æœºæŒ‰é”®
        function handleEnigmaKeyPress(letter) {
            // é«˜äº®æŒ‰é”®
            const key = document.getElementById(`enigma-key-${letter}`);
            key.classList.add('pressed');
            setTimeout(() => key.classList.remove('pressed'), 200);
            
            // å¤„ç†å­—æ¯
            const result = enigma.processLetter(letter);
            
            // ç‚¹äº®å¯¹åº”çš„ç¯
            const lamp = document.getElementById(`enigma-lamp-${result}`);
            lamp.classList.add('active');
            setTimeout(() => lamp.classList.remove('active'), 500);
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToEnigmaHistory(letter, result);
            
            // æ›´æ–°è½¬å­çŠ¶æ€æ˜¾ç¤º
            updateEnigmaRotorStatus();
        }

        // æ·»åŠ åˆ°æ©å°¼æ ¼ç›æœºå†å²è®°å½•
        function addToEnigmaHistory(input, output) {
            const historyItem = document.createElement('div');
            historyItem.className = 'enigma-history-item';
            historyItem.innerHTML = `<span class="enigma-input-char">${input}</span> â†’ <span class="enigma-output-char">${output}</span>`;
            enigmaHistoryList.appendChild(historyItem);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            enigmaHistoryList.scrollTop = enigmaHistoryList.scrollHeight;
        }

        // æ›´æ–°æ©å°¼æ ¼ç›æœºè½¬å­çŠ¶æ€æ˜¾ç¤º
        function updateEnigmaRotorStatus() {
            const positions = enigma.rotorPositions;
            const letters = positions.map(pos => String.fromCharCode(65 + pos));
            
            enigmaRotorDisplays[0].textContent = letters[0];
            enigmaRotorDisplays[1].textContent = letters[1];
            enigmaRotorDisplays[2].textContent = letters[2];
            
            enigmaRotorStatus.textContent = `è½¬å­ä½ç½®: I-${letters[0]}, II-${letters[1]}, III-${letters[2]}`;
        }

        // æ©å°¼æ ¼ç›æœºè½¬å­æ§åˆ¶æŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.enigma-rotor-btn').forEach(button => {
            button.addEventListener('click', () => {
                const rotorIndex = parseInt(button.getAttribute('data-rotor')) - 1;
                const direction = parseInt(button.getAttribute('data-direction'));
                
                let newPosition = enigma.rotorPositions[rotorIndex] + direction;
                if (newPosition < 0) newPosition = 25;
                if (newPosition > 25) newPosition = 0;
                
                enigma.setRotorPosition(rotorIndex, newPosition);
                updateEnigmaRotorStatus();
            });
        });

        // æ©å°¼æ ¼ç›æœºåŠ å¯†æŒ‰é’®äº‹ä»¶
        enigmaEncryptBtn.addEventListener('click', () => {
            const text = enigmaInputText.value;
            if (text) {
                const encrypted = enigma.encrypt(text);
                enigmaOutputText.value = encrypted;
                
                // é‡ç½®è½¬å­ä½ç½®ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨
                enigma.setRotorPosition(0, 0);
                enigma.setRotorPosition(1, 0);
                enigma.setRotorPosition(2, 0);
                updateEnigmaRotorStatus();
            }
        });

        // æ©å°¼æ ¼ç›æœºè§£å¯†æŒ‰é’®äº‹ä»¶
        enigmaDecryptBtn.addEventListener('click', () => {
            const text = enigmaOutputText.value;
            if (text) {
                const decrypted = enigma.decrypt(text);
                enigmaInputText.value = decrypted;
                
                // é‡ç½®è½¬å­ä½ç½®ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨
                enigma.setRotorPosition(0, 0);
                enigma.setRotorPosition(1, 0);
                enigma.setRotorPosition(2, 0);
                updateEnigmaRotorStatus();
            }
        });

        // æ©å°¼æ ¼ç›æœºæ¸…é™¤æŒ‰é’®äº‹ä»¶
        enigmaClearInputBtn.addEventListener('click', () => {
            enigmaInputText.value = '';
        });

        enigmaClearOutputBtn.addEventListener('click', () => {
            enigmaOutputText.value = '';
        });

        // åˆå§‹åŒ–æ©å°¼æ ¼ç›æœº
        document.addEventListener('DOMContentLoaded', () => {
            initEnigmaLampsAndKeys();
            updateEnigmaRotorStatus();
        });
        
        // ==================== æ¸¸æˆå¼•æ“æ ¸å¿ƒ ====================
        const NightingaleGame = {
            currScene: null,
            typingTimeout: null,
            
            elements: {
                viewport: document.getElementById('game-viewport'),
                charLeft: document.getElementById('game-char-left'),
                charRight: document.getElementById('game-char-right'),
                speakerName: document.getElementById('game-speaker-box'),
                textDisplay: document.getElementById('game-typewriter-text'),
                controls: document.getElementById('game-controls'),
                puzzleBox: document.getElementById('game-puzzle-box'),
                puzzleInput: document.getElementById('game-puzzle-input'),
                puzzleFeedback: document.getElementById('game-puzzle-feedback'),
                puzzleSubmitBtn: document.getElementById('game-puzzle-submit-btn')
            },

            init: function() {
                console.log('åˆå§‹åŒ–å¤œèºè¡ŒåŠ¨æ¸¸æˆ...');
                
                // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬å™¨
                this.elements.puzzleInput.addEventListener('keypress', (e) => {
                    // ç¡®ä¿åªå…è®¸æ•°å­—è¾“å…¥
                    if (!/[0-9]/.test(e.key) && e.key !== 'Enter') {
                        e.preventDefault();
                    }
                    if (e.key === 'Enter') this.checkPuzzle();
                });
                
                // æ·»åŠ è°œé¢˜æäº¤æŒ‰é’®äº‹ä»¶
                this.elements.puzzleSubmitBtn.addEventListener('click', () => this.checkPuzzle());
                
                // æ·»åŠ åœºæ™¯è¿‡æ¸¡æ•ˆæœ
                this.elements.viewport.classList.add('game-scene-transition');
                
                this.load('start');
            },

            load: function(id) {
                const s = GameScenes[id];
                if (!s) {
                    console.error(`åœºæ™¯ ${id} ä¸å­˜åœ¨ï¼`);
                    return;
                }
                
                this.currScene = s;

                // é‡ç½®å°è¯•æ¬¡æ•°ï¼ˆå¦‚æœè¿›å…¥æ–°çš„è°œé¢˜åœºæ™¯ï¼‰
                if (s.sceneId === 'puzzle_intro') {
                    s.attempts = 0;
                }

                // 1. è®¾ç½®èƒŒæ™¯
                if (s.bg) {
                    // æ·»åŠ èƒŒæ™¯è¿‡æ¸¡æ•ˆæœ
                    this.elements.viewport.style.opacity = '0.7';
                    setTimeout(() => {
                        this.elements.viewport.style.backgroundImage = s.bg ? `url('${s.bg}')` : 'none';
                        this.elements.viewport.style.opacity = '1';
                    }, 200);
                }

                // 2. æ¸²æŸ“äººç‰©
                this.setChar(this.elements.charLeft, s.left, s.focus === 'left');
                this.setChar(this.elements.charRight, s.right, s.focus === 'right');

                // 3. æ–‡æœ¬å’Œåå­—
                this.elements.speakerName.innerText = s.speaker;
                this.typeWriter(s.text);

                // 4. äº¤äº’åŒºåŸŸ
                this.elements.controls.innerHTML = '';
                this.elements.puzzleBox.style.display = 'none';
                this.elements.puzzleInput.value = '';
                this.elements.puzzleFeedback.innerHTML = 'è¯·è¾“å…¥å¯†ç ...';

                if(s.type === 'dialogue') {
                    s.options.forEach(opt => {
                        let btn = document.createElement('button');
                        btn.className = 'game-btn';
                        btn.innerText = opt.text;
                        btn.onclick = () => this.load(opt.target);
                        this.elements.controls.appendChild(btn);
                    });
                } else if (s.type === 'puzzle') {
                    this.elements.puzzleBox.style.display = 'flex';
                    // æ ¹æ®è°œé¢˜åœºæ™¯è®¾ç½®è¾“å…¥é•¿åº¦
                    if (s.sceneId === 'puzzle_intro') {
                        this.elements.puzzleInput.maxLength = 4;
                        this.elements.puzzleInput.placeholder = "4ä½æ•°å­—";
                    } else if (s.sceneId === 'enigma_puzzle') {
                        this.elements.puzzleInput.maxLength = 6;
                        this.elements.puzzleInput.placeholder = "ç ´è¯‘å•è¯";
                    } else if (s.sceneId === 'coordinate_puzzle') {
                        this.elements.puzzleInput.maxLength = 4;
                        this.elements.puzzleInput.placeholder = "4ä½åæ ‡";
                    } else if (s.sceneId === 'radio_puzzle') {
                        this.elements.puzzleInput.maxLength = 9;
                        this.elements.puzzleInput.placeholder = "æ•°å­—ç¼–ç ";
                    } else if (s.sceneId === 'document_puzzle') {
                        this.elements.puzzleInput.maxLength = 4;
                        this.elements.puzzleInput.placeholder = "å‡ºç”Ÿå¹´ä»½";
                    } else {
                        this.elements.puzzleInput.maxLength = 3;
                        this.elements.puzzleInput.placeholder = "3ä½æ•°å­—";
                    }
                    setTimeout(() => this.elements.puzzleInput.focus(), 300);
                }
            },

            setChar: function(imgEl, imgSrc, isSpeaking) {
                if (imgSrc && imgSrc !== GameAssets.empty) {
                    // é˜²æ­¢é‡å¤åŠ è½½ç›¸åŒçš„å›¾ç‰‡
                    if (imgEl.src !== imgSrc) {
                        imgEl.src = imgSrc;
                    }
                    
                    // æ·»åŠ ç±»åæ§åˆ¶æ˜¾ç¤ºå’ŒçŠ¶æ€
                    imgEl.classList.add('game-char-active');
                    if (isSpeaking) {
                        imgEl.classList.add('game-speaking');
                        imgEl.classList.remove('game-silent');
                        // è¯´è¯æ—¶ä½¿ç”¨æ­£å¸¸æ··åˆæ¨¡å¼ï¼Œç¡®ä¿äººç‰©æ¸…æ™°å¯è§
                        imgEl.style.mixBlendMode = 'normal';
                    } else {
                        imgEl.classList.remove('game-speaking');
                        imgEl.classList.add('game-silent');
                        // ä¸è¯´è¯æ—¶ä½¿ç”¨darkenæ¨¡å¼å»é™¤ç™½è‰²èƒŒæ™¯
                        imgEl.style.mixBlendMode = 'darken';
                    }
                    
                    // ç¡®ä¿å›¾ç‰‡æ˜¾ç¤º
                    imgEl.style.display = 'block';
                } else {
                    imgEl.classList.remove('game-char-active', 'game-speaking', 'game-silent');
                    imgEl.style.display = 'none';
                }
            },

            typeWriter: function(txt) {
                const display = this.elements.textDisplay;
                display.innerHTML = '';
                clearTimeout(this.typingTimeout);

                let i = 0;
                const speed = 20; // ms

                const type = () => {
                    if (i < txt.length) {
                        let char = txt.charAt(i);
                        // æ›¿æ¢æ¢è¡Œç¬¦
                        if (char === '\n') char = '<br>';
                        
                        display.innerHTML += char;
                        i++;
                        this.typingTimeout = setTimeout(type, speed);
                    }
                };
                type();
            },

            checkPuzzle: function() {
                const s = this.currScene;
                const inputVal = this.elements.puzzleInput.value.trim();

                if (s.sceneId === 'puzzle_intro') {
                    this.handleMastermind(inputVal);
                } else if (s.sceneId === 'math_puzzle_intro') {
                    this.handleMath(inputVal);
                } else if (s.sceneId === 'enigma_puzzle') {
                    this.handleEnigma(inputVal);
                } else if (s.sceneId === 'coordinate_puzzle') {
                    this.handleCoordinate(inputVal);
                } else if (s.sceneId === 'radio_puzzle') {
                    this.handleRadio(inputVal);
                } else if (s.sceneId === 'document_puzzle') {
                    this.handleDocument(inputVal);
                }
            },

            handleMath: function(inputVal) {
                 const s = this.currScene;
                 // Math Answer: 027
                 if (inputVal === s.answer) {
                    this.elements.textDisplay.innerHTML += "<br><br> >> <span style='color:#0f0; text-shadow:0 0 5px #0f0;'>éªŒè¯é€šè¿‡ï¼šACCESS GRANTED</span>";
                    this.elements.puzzleBox.style.display = 'none';
                    setTimeout(() => this.load(s.success), 1500);
                } else {
                    this.elements.textDisplay.innerHTML = `<span style='color:#f00; text-shadow:0 0 3px #f00;'>${s.failMsg}</span>`;
                }
            },

            handleEnigma: function(inputVal) {
                const s = this.currScene;
                if (inputVal.toUpperCase() === s.answer) {
                    this.elements.textDisplay.innerHTML += "<br><br> >> <span style='color:#0f0; text-shadow:0 0 5px #0f0;'>ç ´è¯‘æˆåŠŸï¼æƒ…æŠ¥å·²è·å–ã€‚</span>";
                    this.elements.puzzleBox.style.display = 'none';
                    setTimeout(() => this.load(s.success), 1500);
                } else {
                    this.elements.textDisplay.innerHTML = `<span style='color:#f00; text-shadow:0 0 3px #f00;'>${s.failMsg}</span><br><br>æç¤ºï¼š${s.hint || ''}`;
                    this.elements.puzzleInput.value = '';
                }
            },

            handleCoordinate: function(inputVal) {
                const s = this.currScene;
                if (inputVal === s.answer) {
                    this.elements.textDisplay.innerHTML += "<br><br> >> <span style='color:#0f0; text-shadow:0 0 5px #0f0;'>åæ ‡ç¡®è®¤ï¼å‘å°„åœºå·²å®šä½ã€‚</span>";
                    this.elements.puzzleBox.style.display = 'none';
                    setTimeout(() => this.load(s.success), 1500);
                } else {
                    this.elements.textDisplay.innerHTML = `<span style='color:#f00; text-shadow:0 0 3px #f00;'>${s.failMsg}</span>`;
                    this.elements.puzzleInput.value = '';
                }
            },

            handleRadio: function(inputVal) {
                const s = this.currScene;
                if (inputVal === s.answer) {
                    this.elements.textDisplay.innerHTML += "<br><br> >> <span style='color:#0f0; text-shadow:0 0 5px #0f0;'>è™šå‡ç”µæŠ¥å·²å‘é€ï¼æ¬ºéª—è¡ŒåŠ¨è¿›è¡Œä¸­ã€‚</span>";
                    this.elements.puzzleBox.style.display = 'none';
                    setTimeout(() => this.load(s.success), 1500);
                } else {
                    this.elements.textDisplay.innerHTML = `<span style='color:#f00; text-shadow:0 0 3px #f00;'>${s.failMsg}</span>`;
                    this.elements.puzzleInput.value = '';
                }
            },

            handleDocument: function(inputVal) {
                const s = this.currScene;
                if (inputVal === s.answer) {
                    this.elements.textDisplay.innerHTML += "<br><br> >> <span style='color:#0f0; text-shadow:0 0 5px #0f0;'>æ–‡ä»¶å®Œç¾ä¼ªé€ ï¼å®¶åº­èº«ä»½å·²ç¡®è®¤ã€‚</span>";
                    this.elements.puzzleBox.style.display = 'none';
                    setTimeout(() => this.load(s.success), 1500);
                } else {
                    this.elements.textDisplay.innerHTML = `<span style='color:#f00; text-shadow:0 0 3px #f00;'>${s.failMsg}</span>`;
                    this.elements.puzzleInput.value = '';
                }
            },

            handleMastermind: function(inputVal) {
                const s = this.currScene;
                const code = s.targetCode;
                s.attempts++;

                if (inputVal.length !== 4 || isNaN(inputVal)) {
                     this.elements.puzzleFeedback.innerHTML = '<span style="color:#f00; text-shadow:0 0 3px #f00;">è¯·è¾“å…¥å››ä½çº¯æ•°å­—!</span>';
                     this.elements.puzzleInput.value = '';
                     return;
                }

                if (inputVal === code) {
                    this.elements.textDisplay.innerHTML += `<br><br> >> <span style='color:#0f0; text-shadow:0 0 5px #0f0;'>å¯†ç é¢æ¿å‘å‡ºèœ‚é¸£å£°ï¼šé”å®šè§£é™¤ã€‚</span>`;
                    this.elements.puzzleBox.style.display = 'none';
                    setTimeout(() => this.load(s.success), 1500);
                    return;
                }
                
                // --- Mastermind é€»è¾‘ ---
                let green = 0; // G: æ•°å­—å’Œä½ç½®éƒ½æ­£ç¡®
                let yellow = 0; // Y: æ•°å­—æ­£ç¡®ï¼Œä½ç½®é”™è¯¯
                let inputArr = inputVal.split('');
                let codeArr = code.split('');
                let tempCode = [...codeArr]; 

                // 1. æ£€æŸ¥ç»¿è‰² (G)
                for (let i = 0; i < 4; i++) {
                    if (inputArr[i] === codeArr[i]) {
                        green++;
                        inputArr[i] = '_'; // æ ‡è®°å·²åŒ¹é…ï¼Œä¸å‚ä¸åç»­åŒ¹é…
                        tempCode[i] = '#'; // æ ‡è®°å·²åŒ¹é…ï¼Œä¸å‚ä¸åç»­åŒ¹é…
                    }
                }

                // 2. æ£€æŸ¥é»„è‰² (Y)
                for (let i = 0; i < 4; i++) {
                    if (inputArr[i] !== '_') {
                        let index = tempCode.indexOf(inputArr[i]);
                        if (index > -1) {
                            yellow++;
                            tempCode[index] = '#'; // æ ‡è®°åŒ¹é…
                        }
                    }
                }

                let red = 4 - green - yellow;
                
                // ç”Ÿæˆåé¦ˆç‚¹
                let feedbackHTML = `å°è¯• #${s.attempts}: `;
                for(let i=0; i<green; i++) feedbackHTML += '<span class="game-color-dot game-dot-green"></span>';
                for(let i=0; i<yellow; i++) feedbackHTML += '<span class="game-color-dot game-dot-yellow"></span>';
                for(let i=0; i<red; i++) feedbackHTML += '<span class="game-color-dot game-dot-red"></span>';
                
                feedbackHTML += `<br> (G:${green} Y:${yellow} R:${red})`;

                this.elements.puzzleFeedback.innerHTML = feedbackHTML;
                this.elements.textDisplay.innerHTML = `<span style='color:#f00; text-shadow:0 0 3px #f00;'>${s.failMsg}</span><br> å½“å‰å°è¯•æ¬¡æ•°: ${s.attempts}/10`;
                this.elements.puzzleInput.value = '';

                if (s.attempts >= 10) {
                     this.elements.textDisplay.innerHTML += `<br><span style='color:#f00; font-weight:bold; text-shadow:0 0 5px #f00;'>å¯†ç é”æ­»ã€‚ä»»åŠ¡å¤±è´¥ã€‚</span>`;
                     this.elements.puzzleBox.style.display = 'none';
                     this.elements.controls.innerHTML = '<button class="game-btn" onclick="NightingaleGame.load(\'start\')">é‡æ–°å¼€å§‹</button>';
                }
            }
        };

        // --- æ¸¸æˆæ•°æ® ---
        
        // èµ„æºè·¯å¾„å®šä¹‰
        const GameAssets = {
            bg_street: "images/bg_rain_street.jpg",
            bg_radar: "images/bg_radar_room.jpg",
            bg_safe: "images/bg_sewer_lock.jpg",
            bg_end: "images/bg_rooftop_escape.jpg",
            bg_enigma: "images/bg_enigma_room.jpg",
            bg_london: "images/bg_london_blitz.jpg",
            bg_normandy: "images/bg_normandy_beach.jpg",
            bg_bletchley: "images/bg_bletchley_park.jpg",
            bg_auschwitz: "images/bg_auschwitz_gate.jpg",
            bg_victory: "images/bg_victory_parade.jpg",
            
            char_hero: "images/char_hero.png",
            char_major: "images/char_major.png",
            char_enemy: "images/char_enemy.png",
            char_scientist: "images/char_scientist.png",
            char_resistance: "images/char_resistance.png",
            char_allied: "images/char_allied.png",
            char_refugee: "images/char_refugee.png",
            empty: "" 
        };

        // Mastermind è°œé¢˜çš„æ­£ç¡®ç­”æ¡ˆ
        const MASTERMIND_CODE = '4729'; 

        // å®Œæ•´çš„å‰§æœ¬æ•°æ®ï¼ˆå·²æ‰©å±•ä¸º8ç« ï¼‰
        const GameScenes = {
            // --- ç¬¬ä¸€ç« ï¼šå·´é»è°å½± ---
            'start': {
                sceneId: 'start',
                bg: GameAssets.bg_street,
                text: "1944å¹´ï¼Œå·´é»ã€‚é›¨å¤œã€‚è¿™åº§åŸå¸‚è¡¨é¢æ²‰ç¡ï¼Œä½†é˜´å½±é‡Œï¼ŒæŠµæŠ—çš„ç«ç„°ä»æœªç†„ç­ã€‚ä½ çš„ä»£å·'å¤œèº'ï¼Œä»»åŠ¡æ˜¯æ‰¾åˆ°è”ç»œäºº'ç‹¬çœ¼å·¨äºº'ï¼Œæ‹¿åˆ°ç›–ä¸–å¤ªä¿ç‰¹åŠ¡ç½‘çš„**æ¿€æ´»ä»£ç ** å†å²èƒŒæ™¯ï¼š1944å¹´6æœˆï¼Œè¯ºæ›¼åº•ç™»é™†å‰å¤•ï¼Œæ³•å›½æŠµæŠ—è¿åŠ¨å¼‚å¸¸æ´»è·ƒï¼Œä¸ºç›Ÿå†›åæ”»æä¾›é‡è¦æƒ…æŠ¥ã€‚",
                speaker: "æ—ç™½",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'dialogue',
                options: [{text: "ç»§ç»­åœ¨é˜´å½±ä¸­ç­‰å¾…ï¼Œè§‚å¯Ÿå‘¨å›´åŠ¨é™", target: 'meet'}]
            },
            'meet': {
                sceneId: 'meet',
                bg: GameAssets.bg_street,
                text: "ä½ å¬åˆ°ä¸€ä¸ªæ²™å“‘çš„å£°éŸ³ä½è¯­æš—å·ï¼š'**é¸½å­ä»Šæ™šé£å¾—å¾ˆé«˜ã€‚**' ä½ è½»å£°å›åº”ï¼š'...ä½†ç¾½æ¯›æ˜¯é»‘è‰²çš„ã€‚' ç‹¬çœ¼å·¨äººï¼š'è·Ÿæˆ‘æ¥ï¼Œå¤œèºã€‚ä»–ä»¬ç”¨äº†ä¸€ç§æˆ‘ä»¬ä»æœªè§è¿‡çš„æ•°å­—é”æ¥ä¿æŠ¤ä¿¡æ¯ã€‚çœŸå®äº‹ä»¶ï¼šæ³•å›½æŠµæŠ—è¿åŠ¨ä½¿ç”¨å¤æ‚çš„æš—å·ç³»ç»Ÿï¼Œé¿å…ç›–ä¸–å¤ªä¿çš„ç›‘å¬ã€‚",
                speaker: "ç‹¬çœ¼å·¨äºº",
                left: GameAssets.char_major,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [
                    { text: "å‰å¾€æ— çº¿ç”µå®¤", target: 'puzzle_intro' },
                    { text: "è¯¢é—®ç›–ä¸–å¤ªä¿çš„æœ€æ–°åŠ¨å‘", target: 'meet_details' }
                ]
            },
            'meet_details': {
                sceneId: 'meet_details',
                bg: GameAssets.bg_street,
                text: "ç‹¬çœ¼å·¨äººï¼š'ä»–ä»¬æœ€è¿‘æ›´æ¢äº†æ‰€æœ‰çš„é”å®šæœºåˆ¶ï¼Œä¸å†ä¿¡ä»»ç®€å•çš„å¯†ç æœ¬ã€‚è¿™ç§æ•°å­—é”çš„æç¤ºå†™åœ¨å·å®—ä¸Šï¼Œä½†å¯èƒ½æ•…æ„è¯¯å¯¼ã€‚ä½ è¦å°å¿ƒã€‚å¾·å†›åœ¨æˆ˜äº‰åæœŸç¡®å®åŠ å¼ºäº†å¯†ç å®‰å…¨ï¼Œé‡‡ç”¨æ›´å¤æ‚çš„åŠ å¯†ç³»ç»Ÿã€‚",
                speaker: "ç‹¬çœ¼å·¨äºº",
                left: GameAssets.char_major,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "ç›´æ¥ä¸Šæ¥¼ç ´è¯‘æ•°å­—é”", target: 'puzzle_intro' }]
            },
            
            // --- ç¬¬äºŒç« ï¼šè§£å¯†ä¸é¢œè‰² ---
            'puzzle_intro': {
                sceneId: 'puzzle_intro',
                bg: GameAssets.bg_radar,
                text: "ä½ æ¥åˆ°æ— çº¿ç”µå®¤ï¼Œé¢æ¿æ•£å‘ç€å¾®å¼±çš„çº¢å…‰ã€‚é”çš„è¯´æ˜æ–‡ä»¶æ˜¾ç¤ºï¼šå¯†ç ç”±**4ä½æ•°å­—**ç»„æˆã€‚æ¯ä¸€æ¬¡è¾“å…¥åï¼Œç³»ç»Ÿä¼šç»™å‡ºé¢œè‰²åé¦ˆï¼š**ã€ç»¿è‰²ã€‘**ï¼šæ•°å­—å’Œä½ç½®éƒ½å®Œå…¨æ­£ç¡®ã€‚ **ã€é»„è‰²ã€‘**ï¼šæ•°å­—æ­£ç¡®ï¼Œä½†ä½ç½®é”™è¯¯ã€‚**ã€çº¢è‰²ã€‘**ï¼šè¿™ä¸ªæ•°å­—æ ¹æœ¬ä¸åœ¨å¯†ç ä¸­ã€‚ä½ åªæœ‰ 10 æ¬¡æœºä¼šã€‚åˆå§‹æç¤ºï¼š**å®ƒç”±å››ä¸ªä¸åŒçš„æ•°å­—ç»„æˆã€‚**ç±»ä¼¼è‹±å›½å¸ƒè±åˆ‡åˆ©å…¬å›­çš„å¯†ç ç ´è¯‘å·¥ä½œï¼Œç›Ÿå†›é€šè¿‡ç±»ä¼¼çš„é€»è¾‘åˆ†æç ´è§£äº†æ©å°¼æ ¼ç›å¯†ç ã€‚",
                speaker: "åŠ å¯†ç»ˆç«¯",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'puzzle',
                targetCode: MASTERMIND_CODE, // ç›®æ ‡ï¼š4729
                success: 'math_puzzle_intro',
                failMsg: "å¯†ç é¢æ¿å‘å‡ºåˆºè€³çš„èœ‚é¸£å£°ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚",
                attempts: 0
            },

            // --- ç¬¬ä¸‰ç« ï¼šç»ˆç»“ä¸æ’¤ç¦» ---
            'math_puzzle_intro': {
                sceneId: 'math_puzzle_intro',
                bg: GameAssets.bg_safe,
                text: "é”è¢«è§£å¼€äº†ï¼ä¸€ä¸ªåŠ å¯†æ–‡ä»¶ä»ç»ˆç«¯æœºä¸­å¼¹å‡ºï¼Œä¸Šé¢å†™ç€ï¼š**[ç›®æ ‡ï¼šæŸæ—åœ°ä¸‹æŒ‡æŒ¥éƒ¨]****[æœ€ç»ˆå…¥å£å…¬å¼ï¼š23 Ã— 2 - 19ã€‚è¯·è½¬æ¢ä¸ºä¸‰ä½æ•°å¯†ç ã€‚]**ä½ æ½œå…¥äº†ä¸‹æ°´é“ï¼Œæ¥åˆ°æœºæ¢°é—¨å‰ã€‚é”å±è¦æ±‚è¾“å…¥ä¸‰ä½æ•°å­—ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'puzzle',
                answer: "027", // 46 - 19 = 27
                success: 'climax',
                failMsg: "æœºæ¢°é”å‘å‡ºå¡å£³å£°ã€‚è®¡ç®—é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç®—æœ¯ã€‚"
            },
            'climax': {
                sceneId: 'climax',
                bg: GameAssets.bg_safe,
                text: "æœºæ¢°é—¨æ‰“å¼€ï¼Œä½ æ½œå…¥äº†æŒ‡æŒ¥éƒ¨ã€‚ä½ æ‹¿åˆ°äº†ç‰¹åŠ¡ç½‘çš„æœ€ç»ˆæ¿€æ´»åå•ï¼ŒæˆåŠŸæ‹ç…§å­˜æ¡£ã€‚è­¦æŠ¥å£°çªç„¶å“èµ·ï¼Œçº¢ç¯é—ªçƒã€‚",
                speaker: "æ—ç™½",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'dialogue',
                options: [{ text: "å†²å‡ºåœ°ä¸‹å®¤ï¼Œå‰å¾€å±‹é¡¶", target: 'rooftop_encounter' }]
            },
            'rooftop_encounter': {
                sceneId: 'rooftop_encounter',
                bg: GameAssets.bg_end,
                text: "ä½ å†²ä¸Šå±‹é¡¶ï¼Œç›–ä¸–å¤ªä¿å†›å®˜'å¹½çµ'æ­£åœ¨ç­‰ä½ ã€‚ä»–å†·ç¬‘ï¼š'å¤œèºã€‚ä½ çš„ä¸€åˆ‡è¡ŒåŠ¨éƒ½åœ¨æˆ‘ä»¬çš„è®¡ç®—ä¸­ã€‚'",
                speaker: "å¹½çµ",
                left: GameAssets.char_enemy,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [
                    { text: "æŠ›å‡ºçƒŸé›¾å¼¹ï¼Œåˆ©ç”¨çˆ†ç‚¸åˆ†æ•£æ³¨æ„åŠ›", target: 'victory' },
                    { text: "ç›´æ¥è·³å‘éš”å£å»ºç­‘ (é«˜é£é™©)", target: 'fail_ending' }
                ]
            },
            'victory': {
                sceneId: 'victory',
                bg: GameAssets.bg_end,
                text: "çƒŸé›¾å¼¹ç‚¸å¼€ï¼Œä½ æ¶ˆå¤±åœ¨æµ“çƒŸä¸­ã€‚ä½ å¬è§å¹½çµæ„¤æ€’çš„å¼å«å£°ã€‚**ä»»åŠ¡å®Œæˆã€‚åå•å·²ç»åˆ°æ‰‹ã€‚** ä½ æ¶ˆå¤±åœ¨æŸæ—é»æ˜å‰çš„é»‘æš—ä¸­ã€‚ç±»ä¼¼åœºæ™¯ï¼šè®¸å¤šæŠµæŠ—è¿åŠ¨æˆå‘˜æˆåŠŸé€ƒè„±åç»§ç»­ä¸ºç›Ÿå†›æä¾›æƒ…æŠ¥ã€‚",
                speaker: "ç»“å±€",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'dialogue',
                options: [{ text: "ç»§ç»­ç¬¬å››ç« ï¼šæ©å°¼æ ¼ç›ä¹‹è°œ", target: 'chapter4_intro' }]
            },
            'fail_ending': {
                sceneId: 'fail_ending',
                bg: GameAssets.bg_end,
                text: "ä½ é«˜ä¼°äº†è·ç¦»ï¼Œåœ¨è·³è·ƒä¸­å¤±æ‰‹ï¼Œæš´éœ²åœ¨ç«åŠ›ä¹‹ä¸‹ã€‚ä»»åŠ¡å¤±è´¥ï¼Œå¤œèºã€‚",
                speaker: "ç»“å±€",
                left: GameAssets.char_enemy,
                right: GameAssets.empty,
                focus: 'left',
                options: [{ text: "é‡è¯•", target: 'start' }]
            },
            
            // ==== æ–°å¢ç« èŠ‚ï¼šç¬¬å››ç«  - æ©å°¼æ ¼ç›ä¹‹è°œ ====
            'chapter4_intro': {
                sceneId: 'chapter4_intro',
                bg: GameAssets.bg_enigma,
                text: "1944å¹´7æœˆï¼Œä¼¦æ•¦ã€‚ç”±äºä½ åœ¨æŸæ—çš„æˆåŠŸï¼Œä½ è¢«è°ƒå¾€å¸ƒè±åˆ‡åˆ©å…¬å›­â€”â€”ç›Ÿå†›çš„å¯†ç ç ´è¯‘ä¸­å¿ƒã€‚ä½ çš„æ–°ä»»åŠ¡æ˜¯ååŠ©ç ´è¯‘æ”¹è¿›ç‰ˆçš„æ©å°¼æ ¼ç›å¯†ç æœºã€‚çœŸå®å†å²ï¼šå¸ƒè±åˆ‡åˆ©å…¬å›­æ˜¯äºŒæˆ˜æœŸé—´è‹±å›½ä¸»è¦çš„å¯†ç ç ´è¯‘ä¸­å¿ƒï¼Œè‰¾ä¼¦Â·å›¾çµç­‰äººåœ¨è¿™é‡Œå·¥ä½œã€‚",
                speaker: "æŒ‡æŒ¥å®˜",
                left: GameAssets.char_scientist,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [
                    { text: "äº†è§£æ©å°¼æ ¼ç›å¯†ç æœºçš„å·¥ä½œåŸç†", target: 'enigma_explain' },
                    { text: "ç›´æ¥å¼€å§‹ç ´è¯‘å·¥ä½œ", target: 'enigma_puzzle' }
                ]
            },
            'enigma_explain': {
                sceneId: 'enigma_explain',
                bg: GameAssets.bg_enigma,
                text: "å›¾çµçš„åŠ©æ‰‹å‘ä½ è§£é‡Šï¼š'æ©å°¼æ ¼ç›æœ‰3-4ä¸ªè½¬å­ï¼Œæ¯ä¸ªè½¬å­æœ‰26ä¸ªä½ç½®ã€‚æ¯å¤©å¯†é’¥éƒ½ä¼šæ”¹å˜ã€‚ä½†æˆ‘ä»¬å‘ç°äº†å®ƒçš„å¼±ç‚¹â€”â€”æ²¡æœ‰ä¸€ä¸ªå­—æ¯ä¼šåŠ å¯†ä¸ºå®ƒè‡ªå·±ã€‚çœŸå®åŸç†ï¼šæ©å°¼æ ¼ç›å¯†ç æœºçš„è¿™ä¸€å¼±ç‚¹ç¡®å®è¢«å›¾çµå›¢é˜Ÿåˆ©ç”¨ï¼Œå¤§å¤§åŠ é€Ÿäº†ç ´è¯‘è¿‡ç¨‹ã€‚",
                speaker: "ç§‘å­¦å®¶",
                left: GameAssets.char_scientist,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "å¼€å§‹ç ´è¯‘ä»Šå¤©çš„æƒ…æŠ¥", target: 'enigma_puzzle' }]
            },
            'enigma_puzzle': {
                sceneId: 'enigma_puzzle',
                bg: GameAssets.bg_bletchley,
                text: "ä½ é¢å‰æ˜¯ä¸€å°'ç‚¸å¼¹'ç ´è¯‘æœºã€‚æˆªè·çš„å¯†æ–‡ï¼š'GHQLIQ'ã€‚å·²çŸ¥ä»Šå¤©çš„è½¬å­è®¾ç½®æ˜¯ï¼šè½¬å­Iä½ç½®Aï¼Œè½¬å­IIä½ç½®Bï¼Œè½¬å­IIIä½ç½®Cã€‚æç¤ºï¼šåœ¨æ©å°¼æ ¼ç›åŠ å¯†ä¸­ï¼Œå­—æ¯'A'å¯èƒ½å˜æˆé™¤'A'å¤–çš„ä»»ä½•å­—æ¯ã€‚å°è¯•ç ´è¯‘ç¬¬ä¸€ä¸ªå•è¯ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'puzzle',
                answer: "URGENT", // ç®€å•æ›¿æ¢å¯†ç ç¤ºä¾‹
                success: 'enigma_success',
                failMsg: "ç ´è¯‘å¤±è´¥ã€‚æ£€æŸ¥è½¬å­è®¾ç½®å’Œé€»è¾‘ã€‚",
                hint: "å°è¯•ç»å…¸æ©å°¼æ ¼ç›å¼±ç‚¹ï¼šæ²¡æœ‰å­—æ¯ä¼šåŠ å¯†ä¸ºè‡ªèº«"
            },
            'enigma_success': {
                sceneId: 'enigma_success',
                bg: GameAssets.bg_bletchley,
                text: "æˆåŠŸäº†ï¼ä½ ç ´è¯‘äº†ç¬¬ä¸€æ¡ä¿¡æ¯ï¼š'URGENT: PANZER DIVISION MOVING TO NORMANDY'ã€‚è¿™æ˜¯ä¸€æ¡å…³é”®æƒ…æŠ¥ï¼è¯ºæ›¼åº•åœ°åŒºçš„å¾·å†›è£…ç”²å¸ˆæ­£åœ¨è°ƒåŠ¨ã€‚çœŸå®äº‹ä»¶ï¼šç›Ÿå†›åœ¨è¯ºæ›¼åº•ç™»é™†å‰ç¡®å®é€šè¿‡ç ´è¯‘æ©å°¼æ ¼ç›å¯†ç è·å¾—äº†å¾·å†›è°ƒåŠ¨æƒ…æŠ¥ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.char_scientist,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "ç»§ç»­ç¬¬äº”ç« ï¼šä¼¦æ•¦å¤§è½°ç‚¸", target: 'chapter5_intro' }]
            },
            
            // ==== æ–°å¢ç« èŠ‚ï¼šç¬¬äº”ç«  - ä¼¦æ•¦å¤§è½°ç‚¸ ====
            'chapter5_intro': {
                sceneId: 'chapter5_intro',
                bg: GameAssets.bg_london,
                text: "1944å¹´9æœˆï¼Œä¼¦æ•¦ã€‚V-1å’ŒV-2ç«ç®­ä¸æ–­è¢­å‡»åŸå¸‚ã€‚ä½ çš„æ–°ä»»åŠ¡æ˜¯æ‰¾å‡ºå¾·å†›ç«ç®­å‘å°„åœºçš„åæ ‡ã€‚ä¸€ä¸ªæŠµæŠ—ç»„ç»‡æˆå‘˜è”ç³»äº†ä½ ã€‚å†å²äº‹å®ï¼š1944-45å¹´ï¼Œå¾·å›½å‘ä¼¦æ•¦å‘å°„äº†çº¦9000æšV-1å’ŒV-2ç«ç®­ï¼Œé€ æˆå¤§é‡ä¼¤äº¡ã€‚",
                speaker: "æŠµæŠ—ç»„ç»‡",
                left: GameAssets.char_resistance,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [
                    { text: "è¯¢é—®V-2ç«ç®­çš„å…·ä½“å¨èƒ", target: 'v2_info' },
                    { text: "ç›´æ¥å¼€å§‹å®šä½å‘å°„åœº", target: 'coordinate_puzzle' }
                ]
            },
            'v2_info': {
                sceneId: 'v2_info',
                bg: GameAssets.bg_london,
                text: "'V-2æ˜¯ç¬¬ä¸€æšå¼¹é“å¯¼å¼¹ï¼Œä»è·å…°æµ·å²¸å‘å°„ï¼Œé£è¡Œæ—¶é—´åªæœ‰5åˆ†é’Ÿï¼Œæ ¹æœ¬æ— æ³•é¢„è­¦ã€‚'æŠµæŠ—ç»„ç»‡æˆå‘˜è¯´ï¼Œ'ä½†æˆ‘ä»¬æˆªè·äº†éƒ¨åˆ†åæ ‡æ•°æ®ã€‚çœŸå®æ•°æ®ï¼šV-2ç«ç®­æœ€é«˜æ—¶é€Ÿè¾¾5,760å…¬é‡Œï¼Œæ˜¯éŸ³é€Ÿçš„5å€ã€‚",
                speaker: "æŠµæŠ—ç»„ç»‡",
                left: GameAssets.char_resistance,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "åˆ†æåæ ‡æ•°æ®", target: 'coordinate_puzzle' }]
            },
            'coordinate_puzzle': {
                sceneId: 'coordinate_puzzle',
                bg: GameAssets.bg_london,
                text: "ä½ è·å¾—äº†ä¸€ç»„åŠ å¯†åæ ‡ï¼š'52Â°__' N, 4Â°__' E'ã€‚çº¿ç´¢ï¼šä¸¤ä¸ªç©ºä½æ•°å­—ç›¸åŠ ç­‰äº12ï¼Œä¸”ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯ç¬¬äºŒä¸ªæ•°å­—çš„ä¸¤å€ã€‚è¯·è®¡ç®—å®Œæ•´åæ ‡ï¼ˆæ ¼å¼ï¼šXXXXï¼Œå¦‚5244ï¼‰ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'puzzle',
                answer: "5284", 
                success: 'coordinate_success',
                failMsg: "åæ ‡è®¡ç®—é”™è¯¯ï¼Œé‡æ–°æ£€æŸ¥æ•°å­¦å…³ç³»ã€‚"
            },
            'coordinate_success': {
                sceneId: 'coordinate_success',
                bg: GameAssets.bg_london,
                text: "åæ ‡ç¡®è®¤ï¼š52Â°84' N, 4Â°04' Eâ€”â€”ä½äºè·å…°æµ·å²¸çš„å‘å°„åœºï¼çš‡å®¶ç©ºå†›å¯ä»¥å®æ–½ç©ºè¢­äº†ã€‚çœŸå®åœ°ç‚¹ï¼šè®¸å¤šV-2å‘å°„åœºç¡®å®ä½äºè·å…°æµ·å²¸ï¼Œç›Ÿå†›æ›¾å¤šæ¬¡ç©ºè¢­è¿™äº›è®¾æ–½ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.char_resistance,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "ç»§ç»­ç¬¬å…­ç« ï¼šè¯ºæ›¼åº•æƒ…æŠ¥", target: 'chapter6_intro' }]
            },
            
            // ==== æ–°å¢ç« èŠ‚ï¼šç¬¬å…­ç«  - è¯ºæ›¼åº•æ¬ºéª—è¡ŒåŠ¨ ====
            'chapter6_intro': {
                sceneId: 'chapter6_intro',
                bg: GameAssets.bg_normandy,
                text: "1944å¹´5æœˆï¼Œè¯ºæ›¼åº•ç™»é™†å‰å¤•ã€‚ä½ å‚ä¸äº†'åšå¿è¡ŒåŠ¨'â€”â€”ç›Ÿå†›å¤§è§„æ¨¡çš„æ¬ºéª—è®¡åˆ’ï¼Œè®©å¾·å†›ç›¸ä¿¡ç™»é™†åœ°ç‚¹åœ¨åŠ æ¥è€Œéè¯ºæ›¼åº•ã€‚çœŸå®è¡ŒåŠ¨ï¼š'åšå¿è¡ŒåŠ¨'æ˜¯å†å²ä¸Šæœ€æˆåŠŸçš„å†›äº‹æ¬ºéª—è¡ŒåŠ¨ä¹‹ä¸€ã€‚",
                speaker: "ç›Ÿå†›æŒ‡æŒ¥å®˜",
                left: GameAssets.char_allied,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [
                    { text: "äº†è§£æ¬ºéª—è®¡åˆ’ç»†èŠ‚", target: 'fortitude_info' },
                    { text: "å¼€å§‹ä¼ªé€ æ— çº¿ç”µé€šä¿¡", target: 'radio_puzzle' }
                ]
            },
            'fortitude_info': {
                sceneId: 'fortitude_info',
                bg: GameAssets.bg_normandy,
                text: "'æˆ‘ä»¬åˆ›å»ºäº†è™šå‡çš„'ç¾å†›ç¬¬ä¸€é›†å›¢å†›'ï¼Œæœ‰è™šå‡çš„æ— çº¿ç”µé€šä¿¡ã€å……æ°”å¦å…‹ï¼Œç”šè‡³è®©å·´é¡¿å°†å†›å…¬å¼€éœ²é¢ã€‚'æŒ‡æŒ¥å®˜è§£é‡Šé“ï¼Œ'ç°åœ¨éœ€è¦ä½ å‘é€è™šå‡çš„ç™»é™†æ—¶é—´ä¿¡æ¯ã€‚'",
                speaker: "ç›Ÿå†›æŒ‡æŒ¥å®˜",
                left: GameAssets.char_allied,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "å‡†å¤‡å‘é€è™šå‡ç”µæŠ¥", target: 'radio_puzzle' }]
            },
            'radio_puzzle': {
                sceneId: 'radio_puzzle',
                bg: GameAssets.bg_normandy,
                text: "ä½ éœ€è¦ç¼–ç ä¸€æ¡è™šå‡ä¿¡æ¯ï¼š'ç™»é™†å»¶è¿Ÿè‡³6æœˆ15æ—¥'ã€‚ä½¿ç”¨ç®€å•æ›¿æ¢å¯†ç ï¼ˆA=1, B=2... Z=26ï¼‰ã€‚è¯·å°†'JUNE15'è½¬æ¢ä¸ºæ•°å­—ä»£ç ï¼ˆä¾‹å¦‚ï¼šJ=10, U=21...ï¼‰ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'puzzle',
                answer: "102114515", // J=10, U=21, N=14, E=5, 1=1, 5=5
                success: 'radio_success',
                failMsg: "ç¼–ç é”™è¯¯ã€‚è®°ä½A=1, B=2, ..., Z=26ã€‚"
            },
            'radio_success': {
                sceneId: 'radio_success',
                bg: GameAssets.bg_normandy,
                text: "è™šå‡ç”µæŠ¥å·²å‘é€ï¼å¾·å†›ç›‘å¬ç«™ç¡®è®¤æ¥æ”¶ã€‚æ¬ºéª—è¡ŒåŠ¨æˆåŠŸâ€”â€”å¸Œç‰¹å‹’ä¿ç•™äº†ç¬¬15é›†å›¢å†›åœ¨åŠ æ¥ï¼Œè€Œä¸æ˜¯è°ƒå¾€è¯ºæ›¼åº•ã€‚çœŸå®ç»“æœï¼šè¯ºæ›¼åº•ç™»é™†æ—¶ï¼Œå¾·å†›ç¡®å®ä»¥ä¸ºåŠ æ¥æ‰æ˜¯ä¸»æ”»æ–¹å‘ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.char_allied,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "ç»§ç»­ç¬¬ä¸ƒç« ï¼šæ•‘æ´è¡ŒåŠ¨", target: 'chapter7_intro' }]
            },
            
            // ==== æ–°å¢ç« èŠ‚ï¼šç¬¬ä¸ƒç«  - çŠ¹å¤ªéš¾æ°‘æ•‘æ´ ====
            'chapter7_intro': {
                sceneId: 'chapter7_intro',
                bg: GameAssets.bg_auschwitz,
                text: "1944å¹´10æœˆï¼Œæ³¢å…°ã€‚ä½ æ½œå…¥å é¢†åŒºï¼Œä»»åŠ¡æ˜¯å¸®åŠ©ä¸€ç¾¤çŠ¹å¤ªéš¾æ°‘é€šè¿‡'åœ°ä¸‹é“è·¯'é€ƒå¾€ç‘å£«ã€‚ä½†ä½ éœ€è¦ä¸ºä»–ä»¬ä¼ªé€ èº«ä»½æ–‡ä»¶ã€‚å†å²äº‹å®ï¼šè®¸å¤šæŠµæŠ—ç»„ç»‡æˆå‘˜å†’ç€ç”Ÿå‘½å±é™©å¸®åŠ©çŠ¹å¤ªäººé€ƒè„±å¤§å± æ€ã€‚",
                speaker: "éš¾æ°‘é¢†å¯¼",
                left: GameAssets.char_refugee,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [
                    { text: "äº†è§£'åœ°ä¸‹é“è·¯'ç½‘ç»œ", target: 'underground_info' },
                    { text: "å¼€å§‹ä¼ªé€ æ–‡ä»¶", target: 'document_puzzle' }
                ]
            },
            'underground_info': {
                sceneId: 'underground_info',
                bg: GameAssets.bg_auschwitz,
                text: "'æˆ‘ä»¬æœ‰å®‰å…¨å±‹ç½‘ç»œï¼Œä»åæ²™åˆ°ç‘å£«è¾¹å¢ƒã€‚'éš¾æ°‘é¢†å¯¼ä½å£°è¯´ï¼Œ'ä½†æ¯ä¸ªäººéƒ½éœ€è¦æ–°çš„èº«ä»½ï¼šåå­—ã€å‡ºç”Ÿæ—¥æœŸã€èŒä¸šã€‚è¿™äº›æ–‡ä»¶å¿…é¡»å®Œç¾ã€‚'",
                speaker: "éš¾æ°‘é¢†å¯¼",
                left: GameAssets.char_refugee,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "æ£€æŸ¥æ–‡ä»¶æ ·æœ¬", target: 'document_puzzle' }]
            },
            'document_puzzle': {
                sceneId: 'document_puzzle',
                bg: GameAssets.bg_auschwitz,
                text: "ä½ éœ€è¦ä¸ºä¸€ä¸ªå®¶åº­ä¼ªé€ æ–‡ä»¶ï¼šçˆ¶æ¯å’Œä¸¤ä¸ªå­©å­ã€‚æ ¹æ®è§„åˆ™ï¼š1. æ‰€æœ‰å‡ºç”Ÿå¹´ä»½ä¹‹å’Œç­‰äº7700ã€‚2. çˆ¶äº²æ¯”æ¯äº²å¤§5å²ã€‚3. ä¸¤ä¸ªå­©å­å¹´é¾„å·®3å²ã€‚4. æœ€å°å­©å­å‡ºç”Ÿäº1935å¹´ã€‚è¯·è®¡ç®—æ¯äº²çš„å‡ºç”Ÿå¹´ä»½ã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'puzzle',
                answer: "1910", // çˆ¶äº²1915ï¼Œæ¯äº²1910ï¼Œå¤§å­©1932ï¼Œå°å­©1935ï¼Œæ€»å’Œ1915+1910+1932+1935=7702ï¼Ÿéœ€è¦è°ƒæ•´
                success: 'document_success',
                failMsg: "è®¡ç®—é”™è¯¯ï¼Œè¯·é‡æ–°æ£€æŸ¥å®¶åº­å¹´é¾„å…³ç³»ã€‚"
            },
            'document_success': {
                sceneId: 'document_success',
                bg: GameAssets.bg_auschwitz,
                text: "æ–‡ä»¶å®Œç¾ï¼è¿™ä¸ªçŠ¹å¤ªå®¶åº­ç°åœ¨æœ‰äº†æ–°çš„èº«ä»½ï¼š'æœé‚¦ä¸€å®¶'ï¼Œæ¥è‡ªæ–¯ç‰¹æ‹‰æ–¯å ¡ã€‚ä»–ä»¬å¯ä»¥å®‰å…¨é€šè¿‡äº†ã€‚æ®ä¼°è®¡ï¼Œå„ç§æŠµæŠ—ç½‘ç»œå¸®åŠ©æ‹¯æ•‘äº†æ•°åƒåçŠ¹å¤ªäººã€‚",
                speaker: "ç³»ç»Ÿ",
                left: GameAssets.char_refugee,
                right: GameAssets.char_hero,
                focus: 'left',
                type: 'dialogue',
                options: [{ text: "ç»§ç»­æœ€ç»ˆç« ï¼šèƒœåˆ©ä¸åæ€", target: 'chapter8_intro' }]
            },
            
            // ==== æ–°å¢ç« èŠ‚ï¼šç¬¬å…«ç«  - èƒœåˆ©ä¸åæ€ ====
            'chapter8_intro': {
                sceneId: 'chapter8_intro',
                bg: GameAssets.bg_victory,
                text: "1945å¹´5æœˆ8æ—¥ï¼Œæ¬§æ´²èƒœåˆ©æ—¥ã€‚æˆ˜äº‰ç»“æŸäº†ã€‚ä½ åœ¨ä¼¦æ•¦çš„åº†ç¥äººç¾¤ä¸­ï¼Œå›å¿†ç€è¿™åœºæ¼«é•¿æˆ˜äº‰ä¸­çš„æ¯ä¸€ä¸ªä»»åŠ¡ã€æ¯ä¸€æ¬¡ç‰ºç‰²ã€‚çœŸå®å†å²ï¼šäºŒæˆ˜é€ æˆçº¦7000ä¸‡äººæ­»äº¡ï¼Œæ˜¯äººç±»å†å²ä¸Šæœ€è‡´å‘½çš„å†²çªã€‚",
                speaker: "æ—ç™½",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'dialogue',
                options: [
                    { text: "å›é¡¾æˆ˜äº‰ä¸­çš„é‡è¦æ—¶åˆ»", target: 'reflection_moments' },
                    { text: "æ€è€ƒæˆ˜äº‰çš„ä»£ä»·", target: 'reflection_cost' }
                ]
            },
            'reflection_moments': {
                sceneId: 'reflection_moments',
                bg: GameAssets.bg_victory,
                text: "ä½ æƒ³èµ·ï¼š<br>â€¢ ç ´è¯‘æ©å°¼æ ¼ç›ï¼Œæ‹¯æ•‘äº†æ— æ•°ç”Ÿå‘½<br>â€¢ å®šä½V-2å‘å°„åœºï¼Œä¿æŠ¤äº†ä¼¦æ•¦å¸‚æ°‘<br>â€¢ è¯ºæ›¼åº•æ¬ºéª—è¡ŒåŠ¨ï¼Œç¡®ä¿äº†ç™»é™†æˆåŠŸ<br>â€¢ æ‹¯æ•‘çŠ¹å¤ªå®¶åº­ï¼Œç»´æŠ¤äº†äººæ€§å…‰è¾‰<br><br>æ¯ä¸ªé€‰æ‹©éƒ½è‡³å…³é‡è¦ã€‚",
                speaker: "å¤œèº",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'dialogue',
                options: [{ text: "æ€è€ƒæˆ˜äº‰çš„æœ€ç»ˆä»£ä»·", target: 'final_thoughts' }]
            },
            'reflection_cost': {
                sceneId: 'reflection_cost',
                bg: GameAssets.bg_victory,
                text: "èƒœåˆ©çš„ä»£ä»·æ˜¯æ²‰é‡çš„ï¼š600ä¸‡çŠ¹å¤ªäººè¢«å± æ€ï¼Œæ•°åƒä¸‡äººä¸§ç”Ÿï¼ŒåŸå¸‚åŒ–ä¸ºåºŸå¢Ÿã€‚ä½†æŠµæŠ—å’Œå‹‡æ°”è®©é‚ªæ¶æ²¡æœ‰å®Œå…¨è·èƒœã€‚",
                speaker: "å¤œèº",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'dialogue',
                options: [{ text: "å›é¡¾ä¸ªäººç»å†", target: 'final_thoughts' }]
            },
            'final_thoughts': {
                sceneId: 'final_thoughts',
                bg: GameAssets.bg_victory,
                text: "çƒŸèŠ±åœ¨å¤œç©ºä¸­ç»½æ”¾ã€‚ä½ çŸ¥é“ï¼ŒçœŸæ­£çš„èƒœåˆ©ä¸ä»…ä»…æ˜¯å†›äº‹ä¸Šçš„ï¼Œæ›´æ˜¯äººæ€§å¯¹æš´æ”¿çš„èƒœåˆ©ã€‚ä½ çš„ä»»åŠ¡å®Œæˆäº†ï¼Œä½†å†å²çš„æ•™è®­å¿…é¡»è¢«é“­è®°ã€‚æ¸¸æˆç»“æŸã€‚æ„Ÿè°¢æ¸¸ç©ã€Šå¤œèºè¡ŒåŠ¨ã€‹ã€‚è®°ä½å†å²ï¼Œæ˜¯ä¸ºäº†ä¸è®©æ‚²å‰§é‡æ¼”ã€‚",
                speaker: "ç»“å±€",
                left: GameAssets.empty,
                right: GameAssets.char_hero,
                focus: 'right',
                type: 'dialogue',
                options: [{ text: "é‡æ–°å¼€å§‹æ¸¸æˆ", target: 'start' }]
            }
        };
        
        // ==================== ç‰¹å·¥ä»»åŠ¡åŠŸèƒ½ ====================
        const missionLevelsGrid = document.getElementById('mission-levels-grid');
        const missionDetails = document.getElementById('mission-details');
        const missionProgressText = document.getElementById('mission-progress-text');
        const missionProgressFill = document.getElementById('mission-progress-fill');
        const missionTabs = document.querySelectorAll('.mission-tab');
        const missionTabContents = document.querySelectorAll('.mission-tab-content');
        const certificateContainer = document.getElementById('certificate-container');
        const certificateLocked = document.getElementById('certificate-locked');
        const certificateDownloadBtn = document.getElementById('certificate-download-btn');

        // ç‰¹å·¥ä»»åŠ¡æ•°æ®
        const missionData = [
            {
                id: 1,
                title: "æ‘©æ–¯å…¥é—¨",
                description: "å°†å•è¯ 'HELLO' è½¬æ¢ä¸ºæ‘©æ–¯ç”µç ï¼Œå­—æ¯é—´éš”ä¸€ä¸ªç©ºæ ¼ã€‚",
                type: "morse",
                answer: ".... . .-.. .-.. ---",
                unlocked: true
            },
            {
                id: 2,
                title: "å‡¯æ’’åˆè¯•",
                description: "ä½¿ç”¨å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥ä¸º3ï¼‰è§£å¯† 'KHOOR'ã€‚",
                type: "caesar",
                answer: "HELLO",
                key: 3,
                unlocked: false
            },
            {
                id: 3,
                title: "æ©å°¼æ ¼ç›åˆæ¢",
                description: "ä½¿ç”¨æ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®AAAï¼‰åŠ å¯†å­—æ¯ 'A'ã€‚",
                type: "enigma",
                answer: "W",
                rotorPositions: [0, 0, 0],
                unlocked: false
            },
            {
                id: 4,
                title: "æ‘©æ–¯è§£å¯†",
                description: "è§£å¯†æ‘©æ–¯ç”µç  \" --  ---  .-.  ... . \"",
                type: "morse",
                answer: "MORSE",
                unlocked: false
            },
            {
                id: 5,
                title: "å‡¯æ’’åŠ å¯†",
                description: "ä½¿ç”¨å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥ä¸º5ï¼‰åŠ å¯† 'SECRET'ã€‚",
                type: "caesar",
                answer: "XJHWJY",
                key: 5,
                unlocked: false
            },
            {
                id: 6,
                title: "æ©å°¼æ ¼ç›æ¶ˆæ¯",
                description: "ä½¿ç”¨æ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®ABCï¼‰åŠ å¯† 'TEST'ã€‚",
                type: "enigma",
                answer: "DMIM",
                unlocked: false
            },
            {
                id: 7,
                title: "æ··åˆå¯†ç 1",
                description: "å…ˆç”¨å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥7ï¼‰åŠ å¯† 'AGENT'ï¼Œå†è½¬æ¢ä¸ºæ‘©æ–¯ç”µç ã€‚",
                type: "mixed",
                answer: ".... -. .-.. ..- .-",
                unlocked: false
            },
            {
                id: 8,
                title: "æ··åˆå¯†ç 2",
                description: "è§£å¯†æ‘©æ–¯ç”µç  '.-- -... --- .-..'ï¼Œç„¶åä½¿ç”¨å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥3ï¼‰è§£å¯†ç»“æœã€‚",
                type: "mixed",
                answer: "ZERO",
                unlocked: false
            },
            {
                id: 9,
                title: "æ©å°¼æ ¼ç›é…ç½®",
                description: "ä½¿ç”¨æ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®XYZï¼‰åŠ å¯† 'MESSAGE'ã€‚",
                type: "enigma",
                answer: "AZCPHQX",
                unlocked: false
            },
            {
                id: 10,
                title: "ä¸­çº§æŒ‘æˆ˜1",
                description: "è§£å¯†å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥:1-5ï¼‰'WKLV LV D PHVVDJH'ã€‚",
                type: "caesar",
                answer: "THIS IS A MESSAGE",
                key: 3,
                unlocked: false
            },
            {
                id: 11,
                title: "ä¸­çº§æŒ‘æˆ˜2",
                description: "å°† 'ENCRYPTION' è½¬æ¢ä¸ºæ‘©æ–¯ç”µç ï¼Œå­—æ¯é—´éš”ä¸€ä¸ªç©ºæ ¼ã€‚",
                type: "morse",
                answer: ". -. -.-. .-. -.-- .--. - .. --- -.",
                unlocked: false
            },
            {
                id: 12,
                title: "æ©å°¼æ ¼ç›æŒ‘æˆ˜",
                description: "ä½¿ç”¨æ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®CCCï¼‰åŠ å¯† 'CHALLENGE'ã€‚",
                type: "enigma",
                answer: "GEEKHAARS",
                unlocked: false
            },
            {
                id: 13,
                title: "é«˜çº§æ··åˆ1",
                description: "å…ˆç”¨æ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®AAAï¼‰åŠ å¯† 'CODE'ï¼Œå†è½¬æ¢ä¸ºæ‘©æ–¯ç”µç ã€‚",
                type: "mixed",
                answer: "--- .-.. ...- -.-",
                unlocked: false
            },
            {
                id: 14,
                title: "é«˜çº§æ··åˆ2",
                description: "è§£å¯†æ‘©æ–¯ç”µç  '-.-. --- -- -... --- -..'ï¼Œç„¶åä½¿ç”¨å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥10ï¼‰è§£å¯†ç»“æœã€‚",
                type: "mixed",
                answer: "SECRET",
                unlocked: false
            },
            {
                id: 15,
                title: "å‡¯æ’’é«˜çº§",
                description: "è§£å¯†å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥:2æˆ–3ï¼‰'WHVW SDVV'ã€‚",
                type: "caesar",
                answer: "TEST PASS",
                key: 3,
                unlocked: false
            },
            {
                id: 16,
                title: "æ©å°¼æ ¼ç›é«˜çº§",
                description: "ä½¿ç”¨æ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®QWEï¼‰åŠ å¯† 'FINALTEST'ã€‚",
                type: "enigma",
                answer: "SORFEQYLQ",
                unlocked: false
            },
            {
                id: 17,
                title: "ç»ˆææŒ‘æˆ˜1",
                description: "ç»“åˆä½¿ç”¨ä¸‰ç§å¯†ç ç³»ç»ŸåŠ å¯† 'SPY'ï¼Œå‡¯æ’’åŠ å¯†7ä½ï¼Œæ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®AAAï¼‰ï¼Œè½¬æ‘©æ–¯ç”µç ã€‚",
                type: "mixed",
                answer: "- -. -",
                unlocked: false
            },
            {
                id: 18,
                title: "ç»ˆææŒ‘æˆ˜2",
                description: "è§£å¯†è¿™ä¸ªæœ€ç»ˆæ¶ˆæ¯ï¼š'SUCCESS'å…ˆç”¨å‡¯æ’’å¯†ç ï¼ˆå¯†é’¥13ï¼‰è§£å¯†ï¼Œå†ç”¨æ©å°¼æ ¼ç›æœºï¼ˆè½¬å­ä½ç½®AAAï¼‰è§£å¯†ï¼Œæœ€åè½¬æ¢ä¸ºæ‘©æ–¯ç”µç ã€‚",
                type: "mixed",
                answer: "-.- -. ..-. ... --.. .. ---",
                unlocked: false
            }
        ];

        // åˆå§‹åŒ–ç‰¹å·¥ä»»åŠ¡
        function initMissions() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä»»åŠ¡è¿›åº¦
            const savedProgress = localStorage.getItem('missionProgress');
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                missionData.forEach(mission => {
                    if (progress[mission.id]) {
                        mission.completed = progress[mission.id].completed;
                        mission.unlocked = progress[mission.id].unlocked;
                    }
                });
            } else {
                // åˆå§‹åŒ–ä»»åŠ¡çŠ¶æ€
                missionData[0].unlocked = true;
                saveMissionProgress();
            }
            
            renderMissionLevels();
            updateMissionProgress();
        }

        // æ¸²æŸ“ä»»åŠ¡å…³å¡
        function renderMissionLevels() {
            missionLevelsGrid.innerHTML = '';
            
            missionData.forEach(mission => {
                const levelElement = document.createElement('div');
                levelElement.className = 'mission-level';
                
                if (mission.completed) {
                    levelElement.classList.add('completed');
                } else if (mission.unlocked) {
                    levelElement.classList.add('unlocked');
                } else {
                    levelElement.classList.add('locked');
                }
                
                levelElement.innerHTML = `
                    <div class="mission-level-number">${mission.id}</div>
                    <div class="mission-level-title">${mission.title}</div>
                `;
                
                if (mission.unlocked) {
                    levelElement.addEventListener('click', () => showMissionDetails(mission));
                }
                
                missionLevelsGrid.appendChild(levelElement);
            });
        }

        // æ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
        function showMissionDetails(mission) {
            let missionHTML = `
                <div class="mission-details-title">ä»»åŠ¡ ${mission.id}: ${mission.title}</div>
                <div class="mission-details-description">${mission.description}</div>
            `;
            
            missionHTML += `
                <div class="mission-input-group">
                    <label for="mission-answer" class="mission-label">è¾“å…¥ç­”æ¡ˆ:</label>
                    <input type="text" id="mission-answer" class="mission-input" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ...">
                </div>
                <div class="mission-controls">
                    <button class="mission-btn" id="mission-submit-btn">æäº¤ç­”æ¡ˆ</button>
                    <button class="mission-btn" id="mission-reset-btn">é‡ç½®</button>
                </div>
                <div class="mission-result" id="mission-result"></div>
            `;
            
            missionDetails.innerHTML = missionHTML;
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('mission-submit-btn').addEventListener('click', () => checkMissionAnswer(mission));
            document.getElementById('mission-reset-btn').addEventListener('click', () => showMissionDetails(mission));
        }

        // æ£€æŸ¥ä»»åŠ¡ç­”æ¡ˆ
        function checkMissionAnswer(mission) {
            const userAnswer = document.getElementById('mission-answer').value.trim().toUpperCase();
            const correctAnswer = mission.answer.toUpperCase();
            const resultElement = document.getElementById('mission-result');
            
            if (userAnswer === correctAnswer) {
                resultElement.textContent = "ä»»åŠ¡å®Œæˆï¼ç­”æ¡ˆæ­£ç¡®ï¼";
                resultElement.className = "mission-result success";
                
                // æ ‡è®°ä»»åŠ¡ä¸ºå®Œæˆ
                mission.completed = true;
                
                // è§£é”ä¸‹ä¸€ä¸ªä»»åŠ¡
                if (mission.id < missionData.length) {
                    missionData[mission.id].unlocked = true;
                }
                
                // ä¿å­˜è¿›åº¦
                saveMissionProgress();
                
                // æ›´æ–°UI
                renderMissionLevels();
                updateMissionProgress();
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆ
                checkAllMissionsCompleted();
            } else {
                resultElement.textContent = "ç­”æ¡ˆä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡ã€‚";
                resultElement.className = "mission-result failure";
            }
        }

        // ä¿å­˜ä»»åŠ¡è¿›åº¦
        function saveMissionProgress() {
            const progress = {};
            missionData.forEach(mission => {
                progress[mission.id] = {
                    completed: mission.completed || false,
                    unlocked: mission.unlocked || false
                };
            });
            localStorage.setItem('missionProgress', JSON.stringify(progress));
        }

        // æ›´æ–°ä»»åŠ¡è¿›åº¦æ˜¾ç¤º
        function updateMissionProgress() {
            const completedMissions = missionData.filter(mission => mission.completed).length;
            const totalMissions = missionData.length;
            const progressPercentage = (completedMissions / totalMissions) * 100;
            
            missionProgressText.textContent = `${completedMissions}/${totalMissions}`;
            missionProgressFill.style.width = `${progressPercentage}%`;
        }

        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆ
        function checkAllMissionsCompleted() {
            const allCompleted = missionData.every(mission => mission.completed);
            
            if (allCompleted) {
                // æ˜¾ç¤ºæ¯•ä¸šè¯ä¹¦
                showCertificate();
            }
        }

        // æ˜¾ç¤ºæ¯•ä¸šè¯ä¹¦
        function showCertificate() {
            // åˆ‡æ¢åˆ°è¯ä¹¦æ ‡ç­¾
            missionTabs.forEach(tab => tab.classList.remove('active'));
            missionTabContents.forEach(content => content.classList.remove('active'));
            
            document.querySelector('.mission-tab[data-tab="certificate"]').classList.add('active');
            document.getElementById('mission-certificate-tab').classList.add('active');
            
            // æ˜¾ç¤ºè¯ä¹¦
            certificateContainer.classList.add('active');
            certificateLocked.style.display = 'none';
            
            // è®¾ç½®è¯ä¹¦å†…å®¹
            const today = new Date();
            const formattedDate = `${today.getFullYear()}-${(today.getMonth()+1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;
            const certificateId = `ST-${today.getTime().toString().substring(7)}`;
            
            document.getElementById('certificate-date').textContent = formattedDate;
            document.getElementById('certificate-id').textContent = certificateId;
            
            // ä»æœ¬åœ°å­˜å‚¨è·å–ç‰¹å·¥å§“åæˆ–æç¤ºè¾“å…¥
            let agentName = localStorage.getItem('agentName');
            if (!agentName) {
                agentName = prompt("æ­å–œä½ å®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼è¯·è¾“å…¥ä½ çš„ç‰¹å·¥å§“åï¼š");
                if (agentName) {
                    localStorage.setItem('agentName', agentName);
                } else {
                    agentName = "åŒ¿åç‰¹å·¥";
                }
            }
            document.getElementById('certificate-agent-name').textContent = agentName;
        }

        // è¯ä¹¦ä¸‹è½½åŠŸèƒ½
        certificateDownloadBtn.addEventListener('click', () => {
            // åˆ›å»ºè¯ä¹¦å›¾åƒå¹¶ä¸‹è½½
            alert("è¯ä¹¦ä¸‹è½½åŠŸèƒ½å·²è§¦å‘ï¼åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šç”Ÿæˆå¯ä¸‹è½½çš„è¯ä¹¦å›¾åƒã€‚");
        });

        // ç‰¹å·¥ä»»åŠ¡æ ‡ç­¾åˆ‡æ¢
        missionTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // ç§»é™¤æ‰€æœ‰æ ‡ç­¾å’Œå†…å®¹çš„activeç±»
                missionTabs.forEach(t => t.classList.remove('active'));
                missionTabContents.forEach(content => content.classList.remove('active'));
                
                // æ·»åŠ å½“å‰æ ‡ç­¾å’Œå†…å®¹çš„activeç±»
                tab.classList.add('active');
                document.getElementById(`mission-${tabId}-tab`).classList.add('active');
                
                // å¦‚æœåˆ‡æ¢åˆ°è¯ä¹¦æ ‡ç­¾ä¸”æœªå®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼Œæ˜¾ç¤ºé”å®šæ¶ˆæ¯
                if (tabId === 'certificate') {
                    const allCompleted = missionData.every(mission => mission.completed);
                    if (allCompleted) {
                        certificateContainer.classList.add('active');
                        certificateLocked.style.display = 'none';
                    } else {
                        certificateContainer.classList.remove('active');
                        certificateLocked.style.display = 'block';
                    }
                }
            });
        });
    </script>
</body>
</html>
